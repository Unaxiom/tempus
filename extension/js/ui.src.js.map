{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/chrome-promise/chrome-promise.js","src/js/commons.js","src/js/ui.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7eA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ui.src.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/*!\n * chrome-promise\n * https://github.com/tfoxy/chrome-promise\n *\n * Copyright 2015 TomÃ¡s Fox\n * Released under the MIT license\n */\n\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define([], factory.bind(null, typeof exports === 'object' ? this : root));\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = factory(this);\n  } else {\n    // Browser globals (root is window)\n    root.ChromePromise = factory(root);\n  }\n}(this, function(root) {\n  'use strict';\n  var slice = Array.prototype.slice,\n      hasOwnProperty = Object.prototype.hasOwnProperty;\n\n  // Temporary hacky fix to make TypeScript `import` work\n  ChromePromise.default = ChromePromise;\n\n  return ChromePromise;\n\n  ////////////////\n\n  function ChromePromise(options) {\n    options = options || {};\n    var chrome = options.chrome || root.chrome;\n    var Promise = options.Promise || root.Promise;\n    var runtime = chrome.runtime;\n\n    fillProperties(chrome, this);\n\n    ////////////////\n\n    function setPromiseFunction(fn, thisArg) {\n\n      return function() {\n        var args = slice.call(arguments);\n\n        return new Promise(function(resolve, reject) {\n          args.push(callback);\n\n          fn.apply(thisArg, args);\n\n          function callback() {\n            var err = runtime.lastError;\n            var results = slice.call(arguments);\n            if (err) {\n              reject(err);\n            } else {\n              switch (results.length) {\n                case 0:\n                  resolve();\n                  break;\n                case 1:\n                  resolve(results[0]);\n                  break;\n                default:\n                  resolve(results);\n              }\n            }\n          }\n        });\n\n      };\n\n    }\n\n    function fillProperties(source, target) {\n      for (var key in source) {\n        if (hasOwnProperty.call(source, key)) {\n          var val = source[key];\n          var type = typeof val;\n\n          if (type === 'object' && !(val instanceof ChromePromise)) {\n            target[key] = {};\n            fillProperties(val, target[key]);\n          } else if (type === 'function') {\n            target[key] = setPromiseFunction(val, source);\n          } else {\n            target[key] = val;\n          }\n        }\n      }\n    }\n  }\n}));\n","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar chrome_promise_1 = require(\"chrome-promise\");\r\nvar chromep = new chrome_promise_1.default();\r\n/**Stores the list of URLs */\r\nexports.tempusObjectID = \"tempusArray\";\r\nexports.tempusRefresherID = \"tempusRefresher\";\r\nexports.refreshDelayInMins = (1 / 60);\r\nvar refreshDelayInMilliSeconds = exports.refreshDelayInMins * 60 * 1000;\r\nexports.refreshAlarm = \"Alarm\";\r\nvar firefoxBrowser = 'firefox';\r\nvar chromeBrowser = 'chrome';\r\nvar browserName;\r\nif (navigator.userAgent.indexOf(\"Chrome\") > -1) {\r\n    browserName = chromeBrowser;\r\n}\r\nelse {\r\n    browserName = firefoxBrowser;\r\n}\r\n// let browser = chrome;\r\n/**Retrieves the storage value */\r\nfunction getStorage() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!(browserName == firefoxBrowser)) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, browser.storage.local.get()];\r\n                case 1: return [2 /*return*/, _a.sent()];\r\n                case 2:\r\n                    if (!(browserName == chromeBrowser)) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, chromep.storage.local.get()];\r\n                case 3: return [2 /*return*/, _a.sent()];\r\n                case 4: return [2 /*return*/, {}];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**Sets the storage */\r\nfunction setStorage(storageObject) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!(browserName == firefoxBrowser)) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, browser.storage.local.set(storageObject)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 2:\r\n                    if (!(browserName == chromeBrowser)) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, chromep.storage.local.set(storageObject)];\r\n                case 3:\r\n                    _a.sent();\r\n                    _a.label = 4;\r\n                case 4: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**Clears the storage */\r\nfunction clearStorage() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!(browserName == firefoxBrowser)) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, browser.storage.local.clear()];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 2:\r\n                    if (!(browserName == chromeBrowser)) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, chromep.storage.local.clear()];\r\n                case 3:\r\n                    _a.sent();\r\n                    _a.label = 4;\r\n                case 4: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**Adds an alarm to the appropriate browser */\r\nfunction createBrowserAlarm(alarmName, obj, listener) {\r\n    if (browserName == firefoxBrowser) {\r\n        browser.alarms.create(alarmName, obj);\r\n        browser.alarms.onAlarm.addListener(listener);\r\n    }\r\n    else if (browserName == chromeBrowser) {\r\n        chrome.alarms.create(alarmName, obj);\r\n        chrome.alarms.onAlarm.addListener(listener);\r\n    }\r\n}\r\n/**Clears the browser alarm */\r\nfunction clearBrowserAlarm(alarmName) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!(browserName == firefoxBrowser)) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, browser.alarms.clear(alarmName)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 2:\r\n                    if (!(browserName == chromeBrowser)) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, chromep.alarms.clear(alarmName)];\r\n                case 3:\r\n                    _a.sent();\r\n                    _a.label = 4;\r\n                case 4: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**Returns all the browser tabs on the basis of the query object */\r\nfunction queryBrowserTabs(obj) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!(browserName == firefoxBrowser)) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, browser.tabs.query(obj)];\r\n                case 1: return [2 /*return*/, _a.sent()];\r\n                case 2:\r\n                    if (!(browserName == chromeBrowser)) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, chromep.tabs.query(obj)];\r\n                case 3: return [2 /*return*/, _a.sent()];\r\n                case 4: return [2 /*return*/, []];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.queryBrowserTabs = queryBrowserTabs;\r\n/**Attaches the event handler that is fired when a tab is activated */\r\nfunction addBrowserTabsOnActivatedHandler(callback) {\r\n    if (browserName == firefoxBrowser) {\r\n        browser.tabs.onActivated.addListener(callback);\r\n    }\r\n    else if (browserName == chromeBrowser) {\r\n        chrome.tabs.onActivated.addListener(callback);\r\n    }\r\n}\r\nexports.addBrowserTabsOnActivatedHandler = addBrowserTabsOnActivatedHandler;\r\n/**Attaches the event handler that is fired when a tab is removed */\r\nfunction addBrowserTabsOnRemovedHandler(callback) {\r\n    if (browserName == firefoxBrowser) {\r\n        browser.tabs.onRemoved.addListener(callback);\r\n    }\r\n    else if (browserName == chromeBrowser) {\r\n        chrome.tabs.onRemoved.addListener(callback);\r\n    }\r\n}\r\nexports.addBrowserTabsOnRemovedHandler = addBrowserTabsOnRemovedHandler;\r\n/**Attaches the event handler that is fired when a tab is updated */\r\nfunction addBrowserTabsOnUpdatedHandler(callback) {\r\n    if (browserName == firefoxBrowser) {\r\n        browser.tabs.onUpdated.addListener(callback);\r\n    }\r\n    else if (browserName == chromeBrowser) {\r\n        chrome.tabs.onUpdated.addListener(callback);\r\n    }\r\n}\r\nexports.addBrowserTabsOnUpdatedHandler = addBrowserTabsOnUpdatedHandler;\r\n/**Returns the tempus object */\r\nfunction fetchTempusObject() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var storageObject;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getStorage()];\r\n                case 1:\r\n                    storageObject = _a.sent();\r\n                    if (!!storageObject[exports.tempusObjectID]) return [3 /*break*/, 3];\r\n                    storageObject[exports.tempusObjectID] = {\r\n                        id: exports.tempusObjectID,\r\n                        tempusArray: []\r\n                    };\r\n                    // Write the object to the storage\r\n                    return [4 /*yield*/, setStorage(storageObject)];\r\n                case 2:\r\n                    // Write the object to the storage\r\n                    _a.sent();\r\n                    _a.label = 3;\r\n                case 3: return [4 /*yield*/, getStorage()];\r\n                case 4:\r\n                    storageObject = _a.sent();\r\n                    return [2 /*return*/, storageObject[exports.tempusObjectID]];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.fetchTempusObject = fetchTempusObject;\r\n/**Returns the tempus refresher object */\r\nfunction fetchTempusRefresher() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var storageObject;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getStorage()];\r\n                case 1:\r\n                    storageObject = _a.sent();\r\n                    if (!!storageObject[exports.tempusRefresherID]) return [3 /*break*/, 3];\r\n                    storageObject[exports.tempusRefresherID] = {\r\n                        id: exports.tempusRefresherID,\r\n                        refreshed_at: 0\r\n                    };\r\n                    // Write the object to the storage\r\n                    return [4 /*yield*/, setStorage(storageObject)];\r\n                case 2:\r\n                    // Write the object to the storage\r\n                    _a.sent();\r\n                    _a.label = 3;\r\n                case 3: return [4 /*yield*/, getStorage()];\r\n                case 4:\r\n                    storageObject = _a.sent();\r\n                    return [2 /*return*/, storageObject[exports.tempusRefresherID]];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.fetchTempusRefresher = fetchTempusRefresher;\r\n/**Checks if there are any unclosed tabs and closes them */\r\nfunction closePreviouslyUnclosedTabs() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tempusObject, tempusRefresher, currentTimestamp, timeDelay;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, fetchTempusObject()];\r\n                case 1:\r\n                    tempusObject = _a.sent();\r\n                    return [4 /*yield*/, fetchTempusRefresher()];\r\n                case 2:\r\n                    tempusRefresher = _a.sent();\r\n                    currentTimestamp = new Date().getTime();\r\n                    if (tempusRefresher.refreshed_at <= 0) {\r\n                        // This is the first time this is running\r\n                        return [2 /*return*/];\r\n                    }\r\n                    timeDelay = currentTimestamp - tempusRefresher.refreshed_at;\r\n                    /* Iterate over all the available tempus objects and set their active to false,\r\n                    /* and increase their duration by refreshDelayInMins * 6000\r\n                    */\r\n                    tempusObject.tempusArray.forEach(function (tempusStruct) {\r\n                        if (tempusStruct.active) {\r\n                            tempusStruct.active = false;\r\n                            if (timeDelay > refreshDelayInMilliSeconds) {\r\n                                // If time delay is greater, then the max increment can be the refresh delay\r\n                                tempusStruct.lapsed += refreshDelayInMilliSeconds;\r\n                            }\r\n                            else {\r\n                                // If time delay is lower, then set it to time delay\r\n                                tempusStruct.lapsed += timeDelay;\r\n                            }\r\n                        }\r\n                    });\r\n                    return [4 /*yield*/, storeTempusObject(tempusObject)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, storeTempusRefresher(tempusRefresher)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.closePreviouslyUnclosedTabs = closePreviouslyUnclosedTabs;\r\n/**Returns domain from a passed URL */\r\nfunction returnDomainFromURL(url) {\r\n    var domain = '';\r\n    if (!url) {\r\n        return domain;\r\n    }\r\n    if (url.startsWith(\"http\")) {\r\n        var temp = url.split(\"//\");\r\n        domain = temp[0] + \"//\" + temp[1].split(\"/\")[0];\r\n    }\r\n    else {\r\n        domain = url;\r\n    }\r\n    return domain;\r\n}\r\nexports.returnDomainFromURL = returnDomainFromURL;\r\n/**Stores the tempus object in the storage */\r\nfunction storeTempusObject(obj) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var localObj;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    localObj = {};\r\n                    localObj[exports.tempusObjectID] = obj;\r\n                    return [4 /*yield*/, setStorage(localObj)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.storeTempusObject = storeTempusObject;\r\n/**Stores the tempus refresher in the storage */\r\nfunction storeTempusRefresher(obj) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var localObj;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    localObj = {};\r\n                    localObj[exports.tempusRefresherID] = obj;\r\n                    return [4 /*yield*/, setStorage(localObj)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.storeTempusRefresher = storeTempusRefresher;\r\n/**Updates all the open tabs */\r\nfunction updateOpenTabs() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tabs, tempusObject, tempusRefresher, tempusArrayDomains, j, obj;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, queryBrowserTabs({})];\r\n                case 1:\r\n                    tabs = _a.sent();\r\n                    return [4 /*yield*/, fetchTempusObject()];\r\n                case 2:\r\n                    tempusObject = _a.sent();\r\n                    return [4 /*yield*/, fetchTempusRefresher()];\r\n                case 3:\r\n                    tempusRefresher = _a.sent();\r\n                    tempusArrayDomains = [];\r\n                    for (j = 0; j < tempusObject.tempusArray.length; j++) {\r\n                        obj = tempusObject.tempusArray[j];\r\n                        tempusArrayDomains.push(obj.domain);\r\n                    }\r\n                    // If any of the tabsDomains do not have an entry in tempusArrayDomains, then add it to the list\r\n                    tabs.forEach(function (tab) {\r\n                        if (tab.url) {\r\n                            var domain = returnDomainFromURL(tab.url);\r\n                            var index = tempusArrayDomains.indexOf(domain);\r\n                            if (index == -1) {\r\n                                tempusObject.tempusArray.push({\r\n                                    active: tab.active,\r\n                                    domain: domain,\r\n                                    activatedAt: new Date().getTime(),\r\n                                    lapsed: 0\r\n                                });\r\n                            }\r\n                            else {\r\n                                // Set the tab to active\r\n                                if (tab.active) {\r\n                                    var el = tempusObject.tempusArray[index];\r\n                                    el.active = tab.active;\r\n                                    tempusObject.tempusArray.splice(index, 1, el);\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                    return [4 /*yield*/, storeTempusObject(tempusObject)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.updateOpenTabs = updateOpenTabs;\r\n// Alarms\r\n/**Creates the alarm */\r\nfunction createAlarm() {\r\n    createBrowserAlarm(exports.refreshAlarm, { when: new Date().getTime() + refreshDelayInMilliSeconds }, refreshTimestamp);\r\n}\r\n/**Resets the alarms */\r\nfunction resetAlarm() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, clearBrowserAlarm(exports.refreshAlarm)];\r\n                case 1:\r\n                    _a.sent();\r\n                    createAlarm();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**Event handler that handles the alarm fire */\r\nfunction refreshTimestamp() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tempusRefresher, tempusObject;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, fetchTempusRefresher()];\r\n                case 1:\r\n                    tempusRefresher = _a.sent();\r\n                    tempusRefresher.refreshed_at = new Date().getTime();\r\n                    return [4 /*yield*/, storeTempusRefresher(tempusRefresher)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, fetchTempusObject()];\r\n                case 3:\r\n                    tempusObject = _a.sent();\r\n                    tempusObject.tempusArray.forEach(function (tempusStruct) {\r\n                        if (tempusStruct.active) {\r\n                            tempusStruct.lapsed += tempusRefresher.refreshed_at - tempusStruct.activatedAt;\r\n                            tempusStruct.activatedAt = tempusRefresher.refreshed_at;\r\n                        }\r\n                    });\r\n                    return [4 /*yield*/, storeTempusObject(tempusObject)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, resetAlarm()];\r\n                case 5:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**Handle the first run */\r\nfunction onFirstLoad() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, closePreviouslyUnclosedTabs()];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, updateOpenTabs()];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, resetAlarm()];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.onFirstLoad = onFirstLoad;\r\n/**Deletes the storage */\r\nfunction __deleteStorage() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, clearStorage()];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.__deleteStorage = __deleteStorage;\r\n","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar commons = require(\"./commons\");\r\nvar tableBody = document.getElementById(\"tbody\");\r\nvar resetButton = document.getElementById(\"reset-button\");\r\nvar sortByDomainButton = document.getElementById(\"sort-by-domain\");\r\nvar sortByDurationButton = document.getElementById(\"sort-by-duration\");\r\nvar sortByStatusButton = document.getElementById(\"sort-by-active\");\r\nvar millisecond = 1;\r\nvar second = 1000 * millisecond;\r\nvar minute = 60 * second;\r\nvar hour = 60 * minute;\r\nif (resetButton) {\r\n    resetButton.addEventListener('click', function (evt) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        evt.preventDefault();\r\n                        return [4 /*yield*/, commons.__deleteStorage()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, commons.closePreviouslyUnclosedTabs()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, commons.updateOpenTabs()];\r\n                    case 3:\r\n                        _a.sent();\r\n                        if (tableBody) {\r\n                            tableBody.innerHTML = \"\";\r\n                        }\r\n                        main();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    });\r\n}\r\n/**Toggles the sort order */\r\nfunction toggleSortOrder() {\r\n    var sortOrder = tableBody.getAttribute(\"data-sort-order\");\r\n    if (sortOrder == \"asc\") {\r\n        sortOrder = \"desc\";\r\n    }\r\n    else {\r\n        sortOrder = \"asc\";\r\n    }\r\n    tableBody.setAttribute(\"data-sort-order\", sortOrder);\r\n    return sortOrder;\r\n}\r\nsortByDomainButton.addEventListener('click', function (evt) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var sortOrder;\r\n        return __generator(this, function (_a) {\r\n            evt.preventDefault();\r\n            tableBody.setAttribute(\"data-sort-by\", \"domain\");\r\n            sortOrder = toggleSortOrder();\r\n            attachArrow(this, sortOrder, \"Domain\");\r\n            main();\r\n            return [2 /*return*/];\r\n        });\r\n    });\r\n});\r\nsortByDurationButton.addEventListener('click', function (evt) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var sortOrder;\r\n        return __generator(this, function (_a) {\r\n            evt.preventDefault();\r\n            tableBody.setAttribute(\"data-sort-by\", \"duration\");\r\n            sortOrder = toggleSortOrder();\r\n            attachArrow(this, sortOrder, \"Duration\");\r\n            main();\r\n            return [2 /*return*/];\r\n        });\r\n    });\r\n});\r\nsortByStatusButton.addEventListener('click', function (evt) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var sortOrder;\r\n        return __generator(this, function (_a) {\r\n            evt.preventDefault();\r\n            tableBody.setAttribute(\"data-sort-by\", \"active\");\r\n            sortOrder = toggleSortOrder();\r\n            /**Copy from here */\r\n            attachArrow(this, sortOrder, \"Status\");\r\n            /**Until here */\r\n            main();\r\n            return [2 /*return*/];\r\n        });\r\n    });\r\n});\r\nfunction attachArrow(th, sortOrder, type) {\r\n    var i = th.parentElement.getElementsByTagName(\"i\")[0];\r\n    if (sortOrder == \"asc\") {\r\n        i.className = \"fa fa-arrow-up\";\r\n    }\r\n    else {\r\n        i.className = \"fa fa-arrow-down\";\r\n    }\r\n    // Remove it from the current location\r\n    var parentEl = i.parentElement;\r\n    parentEl.removeChild(i);\r\n    // Append it\r\n    th.innerHTML = \"\";\r\n    th.insertAdjacentHTML(\"afterbegin\", i.outerHTML + type);\r\n}\r\n/**Main runner */\r\nfunction main() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tempusObject, sortOrder, sortBy;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, commons.fetchTempusObject()];\r\n                case 1:\r\n                    tempusObject = _a.sent();\r\n                    sortOrder = tableBody.getAttribute(\"data-sort-order\");\r\n                    sortBy = tableBody.getAttribute(\"data-sort-by\");\r\n                    // Sort by Active\r\n                    tempusObject.tempusArray.sort(function (a, b) {\r\n                        if (sortBy == \"duration\") {\r\n                            return sortByDuration(a, b, sortOrder);\r\n                        }\r\n                        else if (sortBy == \"domain\") {\r\n                            return sortByDomain(a, b, sortOrder);\r\n                        }\r\n                        return sortByActive(a, b, sortOrder);\r\n                    });\r\n                    renderTable(tempusObject);\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**Sorts the tempusArray by Domain */\r\nfunction sortByDomain(a, b, order) {\r\n    if (!order) {\r\n        order = 'asc';\r\n    }\r\n    if (a.domain > b.domain) {\r\n        if (order == \"asc\") {\r\n            return -1;\r\n        }\r\n        else {\r\n            return 1;\r\n        }\r\n    }\r\n    if (order == \"asc\") {\r\n        return 1;\r\n    }\r\n    return -1;\r\n}\r\n/**Sorts the tempusArray by Duration */\r\nfunction sortByDuration(a, b, order) {\r\n    if (!order) {\r\n        order = 'asc';\r\n    }\r\n    if (a.lapsed > b.lapsed) {\r\n        if (order == \"asc\") {\r\n            return -1;\r\n        }\r\n        else {\r\n            return 1;\r\n        }\r\n    }\r\n    if (order == \"asc\") {\r\n        return 1;\r\n    }\r\n    return -1;\r\n}\r\n/**Sorts the tempusArray by ACTIVE */\r\nfunction sortByActive(a, b, order) {\r\n    if (!order) {\r\n        order = 'asc';\r\n    }\r\n    if (a.active > b.active) {\r\n        if (order == \"asc\") {\r\n            return -1;\r\n        }\r\n        else {\r\n            return 1;\r\n        }\r\n    }\r\n    if (order == \"asc\") {\r\n        return 1;\r\n    }\r\n    return -1;\r\n}\r\n/**Renders the table displaying the domain and duration */\r\nfunction renderTable(tempusObject) {\r\n    var tableBodyString = '';\r\n    tempusObject.tempusArray.forEach(function (tempus) {\r\n        tableBodyString += \"\\n        <tr class='\" + returnRowClass(tempus.active) + \"'>\\n            <td>\" + tempus.domain + \"</td>\\n            <td>\" + returnTimeLapsed(tempus.lapsed) + \"</td>\\n            <td>\" + returnActiveStatus(tempus.active) + \"</td>\\n        </tr>\\n        \";\r\n    });\r\n    // <td>${Math.round(tempus.lapsed / 1000)}s</td>\r\n    if (tableBody) {\r\n        tableBody.innerHTML = tableBodyString;\r\n    }\r\n}\r\n/**Returns the active class color depending on the status */\r\nfunction returnRowClass(active) {\r\n    if (active) {\r\n        return 'green';\r\n    }\r\n    return '';\r\n}\r\n/**Returns the time lapsed in the following format:\r\n * If less than 1 min, format will be Xs\r\n * If greater than 1 min and less than 1 hour, format will be XX:YYm\r\n * Otherwise, will be XX:YY:ZZh */\r\nfunction returnTimeLapsed(lapsed) {\r\n    if (lapsed < minute) {\r\n        return Math.round(lapsed / second).toString() + \"s\";\r\n    }\r\n    else if (lapsed < hour) {\r\n        return pad(Math.round(lapsed / minute)).toString() + \":\" + pad(Math.round((lapsed % minute) / second)).toString() + \"m\";\r\n    }\r\n    var h = Math.round(lapsed / hour);\r\n    var m = Math.round(lapsed % h);\r\n    var s = Math.round((m % minute) / second);\r\n    m = Math.round(m / minute);\r\n    return pad(h).toString() + \":\" + pad(m).toString() + \":\" + pad(s).toString() + \"h\";\r\n}\r\n/**Returns the ACTIVE state */\r\nfunction returnActiveStatus(active) {\r\n    if (active) {\r\n        return \"Active\";\r\n    }\r\n    return \"Inactive\";\r\n}\r\n/**Returns a padded number */\r\nfunction pad(n) {\r\n    return n < 10 ? '0' + n : n;\r\n}\r\nmain();\r\nsetInterval(function () {\r\n    main();\r\n}, 2000);\r\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvY2hyb21lLXByb21pc2UvY2hyb21lLXByb21pc2UuanMiLCJzcmMvanMvY29tbW9ucy5qcyIsInNyYy9qcy91aS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdlQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyohXG4gKiBjaHJvbWUtcHJvbWlzZVxuICogaHR0cHM6Ly9naXRodWIuY29tL3Rmb3h5L2Nocm9tZS1wcm9taXNlXG4gKlxuICogQ29weXJpZ2h0IDIwMTUgVG9tw6FzIEZveFxuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKi9cblxuKGZ1bmN0aW9uKHJvb3QsIGZhY3RvcnkpIHtcbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS5cbiAgICBkZWZpbmUoW10sIGZhY3RvcnkuYmluZChudWxsLCB0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgPyB0aGlzIDogcm9vdCkpO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgIC8vIE5vZGUuIERvZXMgbm90IHdvcmsgd2l0aCBzdHJpY3QgQ29tbW9uSlMsIGJ1dFxuICAgIC8vIG9ubHkgQ29tbW9uSlMtbGlrZSBlbnZpcm9ubWVudHMgdGhhdCBzdXBwb3J0IG1vZHVsZS5leHBvcnRzLFxuICAgIC8vIGxpa2UgTm9kZS5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkodGhpcyk7XG4gIH0gZWxzZSB7XG4gICAgLy8gQnJvd3NlciBnbG9iYWxzIChyb290IGlzIHdpbmRvdylcbiAgICByb290LkNocm9tZVByb21pc2UgPSBmYWN0b3J5KHJvb3QpO1xuICB9XG59KHRoaXMsIGZ1bmN0aW9uKHJvb3QpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UsXG4gICAgICBoYXNPd25Qcm9wZXJ0eSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7XG5cbiAgLy8gVGVtcG9yYXJ5IGhhY2t5IGZpeCB0byBtYWtlIFR5cGVTY3JpcHQgYGltcG9ydGAgd29ya1xuICBDaHJvbWVQcm9taXNlLmRlZmF1bHQgPSBDaHJvbWVQcm9taXNlO1xuXG4gIHJldHVybiBDaHJvbWVQcm9taXNlO1xuXG4gIC8vLy8vLy8vLy8vLy8vLy9cblxuICBmdW5jdGlvbiBDaHJvbWVQcm9taXNlKG9wdGlvbnMpIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICB2YXIgY2hyb21lID0gb3B0aW9ucy5jaHJvbWUgfHwgcm9vdC5jaHJvbWU7XG4gICAgdmFyIFByb21pc2UgPSBvcHRpb25zLlByb21pc2UgfHwgcm9vdC5Qcm9taXNlO1xuICAgIHZhciBydW50aW1lID0gY2hyb21lLnJ1bnRpbWU7XG5cbiAgICBmaWxsUHJvcGVydGllcyhjaHJvbWUsIHRoaXMpO1xuXG4gICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgZnVuY3Rpb24gc2V0UHJvbWlzZUZ1bmN0aW9uKGZuLCB0aGlzQXJnKSB7XG5cbiAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgIGFyZ3MucHVzaChjYWxsYmFjayk7XG5cbiAgICAgICAgICBmbi5hcHBseSh0aGlzQXJnLCBhcmdzKTtcblxuICAgICAgICAgIGZ1bmN0aW9uIGNhbGxiYWNrKCkge1xuICAgICAgICAgICAgdmFyIGVyciA9IHJ1bnRpbWUubGFzdEVycm9yO1xuICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgc3dpdGNoIChyZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0c1swXSk7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHRzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgIH07XG5cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBmaWxsUHJvcGVydGllcyhzb3VyY2UsIHRhcmdldCkge1xuICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkge1xuICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHtcbiAgICAgICAgICB2YXIgdmFsID0gc291cmNlW2tleV07XG4gICAgICAgICAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsO1xuXG4gICAgICAgICAgaWYgKHR5cGUgPT09ICdvYmplY3QnICYmICEodmFsIGluc3RhbmNlb2YgQ2hyb21lUHJvbWlzZSkpIHtcbiAgICAgICAgICAgIHRhcmdldFtrZXldID0ge307XG4gICAgICAgICAgICBmaWxsUHJvcGVydGllcyh2YWwsIHRhcmdldFtrZXldKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHRhcmdldFtrZXldID0gc2V0UHJvbWlzZUZ1bmN0aW9uKHZhbCwgc291cmNlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSB2YWw7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59KSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxudmFyIF9fZ2VuZXJhdG9yID0gKHRoaXMgJiYgdGhpcy5fX2dlbmVyYXRvcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIGJvZHkpIHtcclxuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XHJcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xyXG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcclxuICAgICAgICB3aGlsZSAoXykgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0geVtvcFswXSAmIDIgPyBcInJldHVyblwiIDogb3BbMF0gPyBcInRocm93XCIgOiBcIm5leHRcIl0pICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xyXG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gWzAsIHQudmFsdWVdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cclxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcclxuICAgIH1cclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG52YXIgY2hyb21lX3Byb21pc2VfMSA9IHJlcXVpcmUoXCJjaHJvbWUtcHJvbWlzZVwiKTtcclxudmFyIGNocm9tZXAgPSBuZXcgY2hyb21lX3Byb21pc2VfMS5kZWZhdWx0KCk7XHJcbi8qKlN0b3JlcyB0aGUgbGlzdCBvZiBVUkxzICovXHJcbmV4cG9ydHMudGVtcHVzT2JqZWN0SUQgPSBcInRlbXB1c0FycmF5XCI7XHJcbmV4cG9ydHMudGVtcHVzUmVmcmVzaGVySUQgPSBcInRlbXB1c1JlZnJlc2hlclwiO1xyXG5leHBvcnRzLnJlZnJlc2hEZWxheUluTWlucyA9ICgxIC8gNjApO1xyXG52YXIgcmVmcmVzaERlbGF5SW5NaWxsaVNlY29uZHMgPSBleHBvcnRzLnJlZnJlc2hEZWxheUluTWlucyAqIDYwICogMTAwMDtcclxuZXhwb3J0cy5yZWZyZXNoQWxhcm0gPSBcIkFsYXJtXCI7XHJcbnZhciBmaXJlZm94QnJvd3NlciA9ICdmaXJlZm94JztcclxudmFyIGNocm9tZUJyb3dzZXIgPSAnY2hyb21lJztcclxudmFyIGJyb3dzZXJOYW1lO1xyXG5pZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiQ2hyb21lXCIpID4gLTEpIHtcclxuICAgIGJyb3dzZXJOYW1lID0gY2hyb21lQnJvd3NlcjtcclxufVxyXG5lbHNlIHtcclxuICAgIGJyb3dzZXJOYW1lID0gZmlyZWZveEJyb3dzZXI7XHJcbn1cclxuLy8gbGV0IGJyb3dzZXIgPSBjaHJvbWU7XHJcbi8qKlJldHJpZXZlcyB0aGUgc3RvcmFnZSB2YWx1ZSAqL1xyXG5mdW5jdGlvbiBnZXRTdG9yYWdlKCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKGJyb3dzZXJOYW1lID09IGZpcmVmb3hCcm93c2VyKSkgcmV0dXJuIFszIC8qYnJlYWsqLywgMl07XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgYnJvd3Nlci5zdG9yYWdlLmxvY2FsLmdldCgpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTogcmV0dXJuIFsyIC8qcmV0dXJuKi8sIF9hLnNlbnQoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEoYnJvd3Nlck5hbWUgPT0gY2hyb21lQnJvd3NlcikpIHJldHVybiBbMyAvKmJyZWFrKi8sIDRdO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGNocm9tZXAuc3RvcmFnZS5sb2NhbC5nZXQoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDM6IHJldHVybiBbMiAvKnJldHVybiovLCBfYS5zZW50KCldO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OiByZXR1cm4gWzIgLypyZXR1cm4qLywge31dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG4vKipTZXRzIHRoZSBzdG9yYWdlICovXHJcbmZ1bmN0aW9uIHNldFN0b3JhZ2Uoc3RvcmFnZU9iamVjdCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKGJyb3dzZXJOYW1lID09IGZpcmVmb3hCcm93c2VyKSkgcmV0dXJuIFszIC8qYnJlYWsqLywgMl07XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgYnJvd3Nlci5zdG9yYWdlLmxvY2FsLnNldChzdG9yYWdlT2JqZWN0KV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDRdO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKGJyb3dzZXJOYW1lID09IGNocm9tZUJyb3dzZXIpKSByZXR1cm4gWzMgLypicmVhayovLCA0XTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBjaHJvbWVwLnN0b3JhZ2UubG9jYWwuc2V0KHN0b3JhZ2VPYmplY3QpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSA0O1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OiByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcbi8qKkNsZWFycyB0aGUgc3RvcmFnZSAqL1xyXG5mdW5jdGlvbiBjbGVhclN0b3JhZ2UoKSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEoYnJvd3Nlck5hbWUgPT0gZmlyZWZveEJyb3dzZXIpKSByZXR1cm4gWzMgLypicmVhayovLCAyXTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBicm93c2VyLnN0b3JhZ2UubG9jYWwuY2xlYXIoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDRdO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKGJyb3dzZXJOYW1lID09IGNocm9tZUJyb3dzZXIpKSByZXR1cm4gWzMgLypicmVhayovLCA0XTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBjaHJvbWVwLnN0b3JhZ2UubG9jYWwuY2xlYXIoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gNDtcclxuICAgICAgICAgICAgICAgIGNhc2UgNDogcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG4vKipBZGRzIGFuIGFsYXJtIHRvIHRoZSBhcHByb3ByaWF0ZSBicm93c2VyICovXHJcbmZ1bmN0aW9uIGNyZWF0ZUJyb3dzZXJBbGFybShhbGFybU5hbWUsIG9iaiwgbGlzdGVuZXIpIHtcclxuICAgIGlmIChicm93c2VyTmFtZSA9PSBmaXJlZm94QnJvd3Nlcikge1xyXG4gICAgICAgIGJyb3dzZXIuYWxhcm1zLmNyZWF0ZShhbGFybU5hbWUsIG9iaik7XHJcbiAgICAgICAgYnJvd3Nlci5hbGFybXMub25BbGFybS5hZGRMaXN0ZW5lcihsaXN0ZW5lcik7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChicm93c2VyTmFtZSA9PSBjaHJvbWVCcm93c2VyKSB7XHJcbiAgICAgICAgY2hyb21lLmFsYXJtcy5jcmVhdGUoYWxhcm1OYW1lLCBvYmopO1xyXG4gICAgICAgIGNocm9tZS5hbGFybXMub25BbGFybS5hZGRMaXN0ZW5lcihsaXN0ZW5lcik7XHJcbiAgICB9XHJcbn1cclxuLyoqQ2xlYXJzIHRoZSBicm93c2VyIGFsYXJtICovXHJcbmZ1bmN0aW9uIGNsZWFyQnJvd3NlckFsYXJtKGFsYXJtTmFtZSkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKGJyb3dzZXJOYW1lID09IGZpcmVmb3hCcm93c2VyKSkgcmV0dXJuIFszIC8qYnJlYWsqLywgMl07XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgYnJvd3Nlci5hbGFybXMuY2xlYXIoYWxhcm1OYW1lKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDRdO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKGJyb3dzZXJOYW1lID09IGNocm9tZUJyb3dzZXIpKSByZXR1cm4gWzMgLypicmVhayovLCA0XTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBjaHJvbWVwLmFsYXJtcy5jbGVhcihhbGFybU5hbWUpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSA0O1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OiByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcbi8qKlJldHVybnMgYWxsIHRoZSBicm93c2VyIHRhYnMgb24gdGhlIGJhc2lzIG9mIHRoZSBxdWVyeSBvYmplY3QgKi9cclxuZnVuY3Rpb24gcXVlcnlCcm93c2VyVGFicyhvYmopIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIShicm93c2VyTmFtZSA9PSBmaXJlZm94QnJvd3NlcikpIHJldHVybiBbMyAvKmJyZWFrKi8sIDJdO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGJyb3dzZXIudGFicy5xdWVyeShvYmopXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTogcmV0dXJuIFsyIC8qcmV0dXJuKi8sIF9hLnNlbnQoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEoYnJvd3Nlck5hbWUgPT0gY2hyb21lQnJvd3NlcikpIHJldHVybiBbMyAvKmJyZWFrKi8sIDRdO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGNocm9tZXAudGFicy5xdWVyeShvYmopXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMzogcmV0dXJuIFsyIC8qcmV0dXJuKi8sIF9hLnNlbnQoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IHJldHVybiBbMiAvKnJldHVybiovLCBbXV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcbmV4cG9ydHMucXVlcnlCcm93c2VyVGFicyA9IHF1ZXJ5QnJvd3NlclRhYnM7XHJcbi8qKkF0dGFjaGVzIHRoZSBldmVudCBoYW5kbGVyIHRoYXQgaXMgZmlyZWQgd2hlbiBhIHRhYiBpcyBhY3RpdmF0ZWQgKi9cclxuZnVuY3Rpb24gYWRkQnJvd3NlclRhYnNPbkFjdGl2YXRlZEhhbmRsZXIoY2FsbGJhY2spIHtcclxuICAgIGlmIChicm93c2VyTmFtZSA9PSBmaXJlZm94QnJvd3Nlcikge1xyXG4gICAgICAgIGJyb3dzZXIudGFicy5vbkFjdGl2YXRlZC5hZGRMaXN0ZW5lcihjYWxsYmFjayk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChicm93c2VyTmFtZSA9PSBjaHJvbWVCcm93c2VyKSB7XHJcbiAgICAgICAgY2hyb21lLnRhYnMub25BY3RpdmF0ZWQuYWRkTGlzdGVuZXIoY2FsbGJhY2spO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuYWRkQnJvd3NlclRhYnNPbkFjdGl2YXRlZEhhbmRsZXIgPSBhZGRCcm93c2VyVGFic09uQWN0aXZhdGVkSGFuZGxlcjtcclxuLyoqQXR0YWNoZXMgdGhlIGV2ZW50IGhhbmRsZXIgdGhhdCBpcyBmaXJlZCB3aGVuIGEgdGFiIGlzIHJlbW92ZWQgKi9cclxuZnVuY3Rpb24gYWRkQnJvd3NlclRhYnNPblJlbW92ZWRIYW5kbGVyKGNhbGxiYWNrKSB7XHJcbiAgICBpZiAoYnJvd3Nlck5hbWUgPT0gZmlyZWZveEJyb3dzZXIpIHtcclxuICAgICAgICBicm93c2VyLnRhYnMub25SZW1vdmVkLmFkZExpc3RlbmVyKGNhbGxiYWNrKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGJyb3dzZXJOYW1lID09IGNocm9tZUJyb3dzZXIpIHtcclxuICAgICAgICBjaHJvbWUudGFicy5vblJlbW92ZWQuYWRkTGlzdGVuZXIoY2FsbGJhY2spO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuYWRkQnJvd3NlclRhYnNPblJlbW92ZWRIYW5kbGVyID0gYWRkQnJvd3NlclRhYnNPblJlbW92ZWRIYW5kbGVyO1xyXG4vKipBdHRhY2hlcyB0aGUgZXZlbnQgaGFuZGxlciB0aGF0IGlzIGZpcmVkIHdoZW4gYSB0YWIgaXMgdXBkYXRlZCAqL1xyXG5mdW5jdGlvbiBhZGRCcm93c2VyVGFic09uVXBkYXRlZEhhbmRsZXIoY2FsbGJhY2spIHtcclxuICAgIGlmIChicm93c2VyTmFtZSA9PSBmaXJlZm94QnJvd3Nlcikge1xyXG4gICAgICAgIGJyb3dzZXIudGFicy5vblVwZGF0ZWQuYWRkTGlzdGVuZXIoY2FsbGJhY2spO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoYnJvd3Nlck5hbWUgPT0gY2hyb21lQnJvd3Nlcikge1xyXG4gICAgICAgIGNocm9tZS50YWJzLm9uVXBkYXRlZC5hZGRMaXN0ZW5lcihjYWxsYmFjayk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5hZGRCcm93c2VyVGFic09uVXBkYXRlZEhhbmRsZXIgPSBhZGRCcm93c2VyVGFic09uVXBkYXRlZEhhbmRsZXI7XHJcbi8qKlJldHVybnMgdGhlIHRlbXB1cyBvYmplY3QgKi9cclxuZnVuY3Rpb24gZmV0Y2hUZW1wdXNPYmplY3QoKSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHN0b3JhZ2VPYmplY3Q7XHJcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGdldFN0b3JhZ2UoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmFnZU9iamVjdCA9IF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISFzdG9yYWdlT2JqZWN0W2V4cG9ydHMudGVtcHVzT2JqZWN0SURdKSByZXR1cm4gWzMgLypicmVhayovLCAzXTtcclxuICAgICAgICAgICAgICAgICAgICBzdG9yYWdlT2JqZWN0W2V4cG9ydHMudGVtcHVzT2JqZWN0SURdID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogZXhwb3J0cy50ZW1wdXNPYmplY3RJRCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcHVzQXJyYXk6IFtdXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBXcml0ZSB0aGUgb2JqZWN0IHRvIHRoZSBzdG9yYWdlXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgc2V0U3RvcmFnZShzdG9yYWdlT2JqZWN0KV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gV3JpdGUgdGhlIG9iamVjdCB0byB0aGUgc3RvcmFnZVxyXG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDM7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDM6IHJldHVybiBbNCAvKnlpZWxkKi8sIGdldFN0b3JhZ2UoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6XHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmFnZU9iamVjdCA9IF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgc3RvcmFnZU9iamVjdFtleHBvcnRzLnRlbXB1c09iamVjdElEXV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcbmV4cG9ydHMuZmV0Y2hUZW1wdXNPYmplY3QgPSBmZXRjaFRlbXB1c09iamVjdDtcclxuLyoqUmV0dXJucyB0aGUgdGVtcHVzIHJlZnJlc2hlciBvYmplY3QgKi9cclxuZnVuY3Rpb24gZmV0Y2hUZW1wdXNSZWZyZXNoZXIoKSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHN0b3JhZ2VPYmplY3Q7XHJcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGdldFN0b3JhZ2UoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmFnZU9iamVjdCA9IF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISFzdG9yYWdlT2JqZWN0W2V4cG9ydHMudGVtcHVzUmVmcmVzaGVySURdKSByZXR1cm4gWzMgLypicmVhayovLCAzXTtcclxuICAgICAgICAgICAgICAgICAgICBzdG9yYWdlT2JqZWN0W2V4cG9ydHMudGVtcHVzUmVmcmVzaGVySURdID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogZXhwb3J0cy50ZW1wdXNSZWZyZXNoZXJJRCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaGVkX2F0OiAwXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBXcml0ZSB0aGUgb2JqZWN0IHRvIHRoZSBzdG9yYWdlXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgc2V0U3RvcmFnZShzdG9yYWdlT2JqZWN0KV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gV3JpdGUgdGhlIG9iamVjdCB0byB0aGUgc3RvcmFnZVxyXG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDM7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDM6IHJldHVybiBbNCAvKnlpZWxkKi8sIGdldFN0b3JhZ2UoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6XHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmFnZU9iamVjdCA9IF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgc3RvcmFnZU9iamVjdFtleHBvcnRzLnRlbXB1c1JlZnJlc2hlcklEXV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcbmV4cG9ydHMuZmV0Y2hUZW1wdXNSZWZyZXNoZXIgPSBmZXRjaFRlbXB1c1JlZnJlc2hlcjtcclxuLyoqQ2hlY2tzIGlmIHRoZXJlIGFyZSBhbnkgdW5jbG9zZWQgdGFicyBhbmQgY2xvc2VzIHRoZW0gKi9cclxuZnVuY3Rpb24gY2xvc2VQcmV2aW91c2x5VW5jbG9zZWRUYWJzKCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciB0ZW1wdXNPYmplY3QsIHRlbXB1c1JlZnJlc2hlciwgY3VycmVudFRpbWVzdGFtcCwgdGltZURlbGF5O1xyXG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCBmZXRjaFRlbXB1c09iamVjdCgpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wdXNPYmplY3QgPSBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgZmV0Y2hUZW1wdXNSZWZyZXNoZXIoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcHVzUmVmcmVzaGVyID0gX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRUaW1lc3RhbXAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGVtcHVzUmVmcmVzaGVyLnJlZnJlc2hlZF9hdCA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGZpcnN0IHRpbWUgdGhpcyBpcyBydW5uaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGltZURlbGF5ID0gY3VycmVudFRpbWVzdGFtcCAtIHRlbXB1c1JlZnJlc2hlci5yZWZyZXNoZWRfYXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgLyogSXRlcmF0ZSBvdmVyIGFsbCB0aGUgYXZhaWxhYmxlIHRlbXB1cyBvYmplY3RzIGFuZCBzZXQgdGhlaXIgYWN0aXZlIHRvIGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIC8qIGFuZCBpbmNyZWFzZSB0aGVpciBkdXJhdGlvbiBieSByZWZyZXNoRGVsYXlJbk1pbnMgKiA2MDAwXHJcbiAgICAgICAgICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgICAgICAgICB0ZW1wdXNPYmplY3QudGVtcHVzQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAodGVtcHVzU3RydWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wdXNTdHJ1Y3QuYWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wdXNTdHJ1Y3QuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGltZURlbGF5ID4gcmVmcmVzaERlbGF5SW5NaWxsaVNlY29uZHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aW1lIGRlbGF5IGlzIGdyZWF0ZXIsIHRoZW4gdGhlIG1heCBpbmNyZW1lbnQgY2FuIGJlIHRoZSByZWZyZXNoIGRlbGF5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcHVzU3RydWN0LmxhcHNlZCArPSByZWZyZXNoRGVsYXlJbk1pbGxpU2Vjb25kcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRpbWUgZGVsYXkgaXMgbG93ZXIsIHRoZW4gc2V0IGl0IHRvIHRpbWUgZGVsYXlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wdXNTdHJ1Y3QubGFwc2VkICs9IHRpbWVEZWxheTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHN0b3JlVGVtcHVzT2JqZWN0KHRlbXB1c09iamVjdCldO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBzdG9yZVRlbXB1c1JlZnJlc2hlcih0ZW1wdXNSZWZyZXNoZXIpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNDpcclxuICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5leHBvcnRzLmNsb3NlUHJldmlvdXNseVVuY2xvc2VkVGFicyA9IGNsb3NlUHJldmlvdXNseVVuY2xvc2VkVGFicztcclxuLyoqUmV0dXJucyBkb21haW4gZnJvbSBhIHBhc3NlZCBVUkwgKi9cclxuZnVuY3Rpb24gcmV0dXJuRG9tYWluRnJvbVVSTCh1cmwpIHtcclxuICAgIHZhciBkb21haW4gPSAnJztcclxuICAgIGlmICghdXJsKSB7XHJcbiAgICAgICAgcmV0dXJuIGRvbWFpbjtcclxuICAgIH1cclxuICAgIGlmICh1cmwuc3RhcnRzV2l0aChcImh0dHBcIikpIHtcclxuICAgICAgICB2YXIgdGVtcCA9IHVybC5zcGxpdChcIi8vXCIpO1xyXG4gICAgICAgIGRvbWFpbiA9IHRlbXBbMF0gKyBcIi8vXCIgKyB0ZW1wWzFdLnNwbGl0KFwiL1wiKVswXTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGRvbWFpbiA9IHVybDtcclxuICAgIH1cclxuICAgIHJldHVybiBkb21haW47XHJcbn1cclxuZXhwb3J0cy5yZXR1cm5Eb21haW5Gcm9tVVJMID0gcmV0dXJuRG9tYWluRnJvbVVSTDtcclxuLyoqU3RvcmVzIHRoZSB0ZW1wdXMgb2JqZWN0IGluIHRoZSBzdG9yYWdlICovXHJcbmZ1bmN0aW9uIHN0b3JlVGVtcHVzT2JqZWN0KG9iaikge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBsb2NhbE9iajtcclxuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgICAgICBsb2NhbE9iaiA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsT2JqW2V4cG9ydHMudGVtcHVzT2JqZWN0SURdID0gb2JqO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHNldFN0b3JhZ2UobG9jYWxPYmopXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5leHBvcnRzLnN0b3JlVGVtcHVzT2JqZWN0ID0gc3RvcmVUZW1wdXNPYmplY3Q7XHJcbi8qKlN0b3JlcyB0aGUgdGVtcHVzIHJlZnJlc2hlciBpbiB0aGUgc3RvcmFnZSAqL1xyXG5mdW5jdGlvbiBzdG9yZVRlbXB1c1JlZnJlc2hlcihvYmopIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgbG9jYWxPYmo7XHJcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxPYmogPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICBsb2NhbE9ialtleHBvcnRzLnRlbXB1c1JlZnJlc2hlcklEXSA9IG9iajtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBzZXRTdG9yYWdlKGxvY2FsT2JqKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuZXhwb3J0cy5zdG9yZVRlbXB1c1JlZnJlc2hlciA9IHN0b3JlVGVtcHVzUmVmcmVzaGVyO1xyXG4vKipVcGRhdGVzIGFsbCB0aGUgb3BlbiB0YWJzICovXHJcbmZ1bmN0aW9uIHVwZGF0ZU9wZW5UYWJzKCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciB0YWJzLCB0ZW1wdXNPYmplY3QsIHRlbXB1c1JlZnJlc2hlciwgdGVtcHVzQXJyYXlEb21haW5zLCBqLCBvYmo7XHJcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIHF1ZXJ5QnJvd3NlclRhYnMoe30pXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICB0YWJzID0gX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGZldGNoVGVtcHVzT2JqZWN0KCldO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXB1c09iamVjdCA9IF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBmZXRjaFRlbXB1c1JlZnJlc2hlcigpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wdXNSZWZyZXNoZXIgPSBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcHVzQXJyYXlEb21haW5zID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IHRlbXB1c09iamVjdC50ZW1wdXNBcnJheS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmogPSB0ZW1wdXNPYmplY3QudGVtcHVzQXJyYXlbal07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXB1c0FycmF5RG9tYWlucy5wdXNoKG9iai5kb21haW4pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBJZiBhbnkgb2YgdGhlIHRhYnNEb21haW5zIGRvIG5vdCBoYXZlIGFuIGVudHJ5IGluIHRlbXB1c0FycmF5RG9tYWlucywgdGhlbiBhZGQgaXQgdG8gdGhlIGxpc3RcclxuICAgICAgICAgICAgICAgICAgICB0YWJzLmZvckVhY2goZnVuY3Rpb24gKHRhYikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFiLnVybCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRvbWFpbiA9IHJldHVybkRvbWFpbkZyb21VUkwodGFiLnVybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSB0ZW1wdXNBcnJheURvbWFpbnMuaW5kZXhPZihkb21haW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcHVzT2JqZWN0LnRlbXB1c0FycmF5LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmU6IHRhYi5hY3RpdmUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvbWFpbjogZG9tYWluLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmF0ZWRBdDogbmV3IERhdGUoKS5nZXRUaW1lKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhcHNlZDogMFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSB0YWIgdG8gYWN0aXZlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhYi5hY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVsID0gdGVtcHVzT2JqZWN0LnRlbXB1c0FycmF5W2luZGV4XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuYWN0aXZlID0gdGFiLmFjdGl2ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcHVzT2JqZWN0LnRlbXB1c0FycmF5LnNwbGljZShpbmRleCwgMSwgZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHN0b3JlVGVtcHVzT2JqZWN0KHRlbXB1c09iamVjdCldO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OlxyXG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcbmV4cG9ydHMudXBkYXRlT3BlblRhYnMgPSB1cGRhdGVPcGVuVGFicztcclxuLy8gQWxhcm1zXHJcbi8qKkNyZWF0ZXMgdGhlIGFsYXJtICovXHJcbmZ1bmN0aW9uIGNyZWF0ZUFsYXJtKCkge1xyXG4gICAgY3JlYXRlQnJvd3NlckFsYXJtKGV4cG9ydHMucmVmcmVzaEFsYXJtLCB7IHdoZW46IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgcmVmcmVzaERlbGF5SW5NaWxsaVNlY29uZHMgfSwgcmVmcmVzaFRpbWVzdGFtcCk7XHJcbn1cclxuLyoqUmVzZXRzIHRoZSBhbGFybXMgKi9cclxuZnVuY3Rpb24gcmVzZXRBbGFybSgpIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgY2xlYXJCcm93c2VyQWxhcm0oZXhwb3J0cy5yZWZyZXNoQWxhcm0pXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlQWxhcm0oKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcbi8qKkV2ZW50IGhhbmRsZXIgdGhhdCBoYW5kbGVzIHRoZSBhbGFybSBmaXJlICovXHJcbmZ1bmN0aW9uIHJlZnJlc2hUaW1lc3RhbXAoKSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHRlbXB1c1JlZnJlc2hlciwgdGVtcHVzT2JqZWN0O1xyXG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCBmZXRjaFRlbXB1c1JlZnJlc2hlcigpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wdXNSZWZyZXNoZXIgPSBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcHVzUmVmcmVzaGVyLnJlZnJlc2hlZF9hdCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHN0b3JlVGVtcHVzUmVmcmVzaGVyKHRlbXB1c1JlZnJlc2hlcildO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBmZXRjaFRlbXB1c09iamVjdCgpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wdXNPYmplY3QgPSBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcHVzT2JqZWN0LnRlbXB1c0FycmF5LmZvckVhY2goZnVuY3Rpb24gKHRlbXB1c1N0cnVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVtcHVzU3RydWN0LmFjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcHVzU3RydWN0LmxhcHNlZCArPSB0ZW1wdXNSZWZyZXNoZXIucmVmcmVzaGVkX2F0IC0gdGVtcHVzU3RydWN0LmFjdGl2YXRlZEF0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcHVzU3RydWN0LmFjdGl2YXRlZEF0ID0gdGVtcHVzUmVmcmVzaGVyLnJlZnJlc2hlZF9hdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHN0b3JlVGVtcHVzT2JqZWN0KHRlbXB1c09iamVjdCldO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OlxyXG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCByZXNldEFsYXJtKCldO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA1OlxyXG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcbi8qKkhhbmRsZSB0aGUgZmlyc3QgcnVuICovXHJcbmZ1bmN0aW9uIG9uRmlyc3RMb2FkKCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCBjbG9zZVByZXZpb3VzbHlVbmNsb3NlZFRhYnMoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHVwZGF0ZU9wZW5UYWJzKCldO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCByZXNldEFsYXJtKCldO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcbmV4cG9ydHMub25GaXJzdExvYWQgPSBvbkZpcnN0TG9hZDtcclxuLyoqRGVsZXRlcyB0aGUgc3RvcmFnZSAqL1xyXG5mdW5jdGlvbiBfX2RlbGV0ZVN0b3JhZ2UoKSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGNsZWFyU3RvcmFnZSgpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5leHBvcnRzLl9fZGVsZXRlU3RvcmFnZSA9IF9fZGVsZXRlU3RvcmFnZTtcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbnZhciBfX2dlbmVyYXRvciA9ICh0aGlzICYmIHRoaXMuX19nZW5lcmF0b3IpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBib2R5KSB7XHJcbiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xyXG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcclxuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XHJcbiAgICAgICAgd2hpbGUgKF8pIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IHlbb3BbMF0gJiAyID8gXCJyZXR1cm5cIiA6IG9wWzBdID8gXCJ0aHJvd1wiIDogXCJuZXh0XCJdKSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcclxuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFswLCB0LnZhbHVlXTtcclxuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xyXG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XHJcbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XHJcbiAgICB9XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxudmFyIGNvbW1vbnMgPSByZXF1aXJlKFwiLi9jb21tb25zXCIpO1xyXG52YXIgdGFibGVCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0Ym9keVwiKTtcclxudmFyIHJlc2V0QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXNldC1idXR0b25cIik7XHJcbnZhciBzb3J0QnlEb21haW5CdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNvcnQtYnktZG9tYWluXCIpO1xyXG52YXIgc29ydEJ5RHVyYXRpb25CdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNvcnQtYnktZHVyYXRpb25cIik7XHJcbnZhciBzb3J0QnlTdGF0dXNCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNvcnQtYnktYWN0aXZlXCIpO1xyXG52YXIgbWlsbGlzZWNvbmQgPSAxO1xyXG52YXIgc2Vjb25kID0gMTAwMCAqIG1pbGxpc2Vjb25kO1xyXG52YXIgbWludXRlID0gNjAgKiBzZWNvbmQ7XHJcbnZhciBob3VyID0gNjAgKiBtaW51dGU7XHJcbmlmIChyZXNldEJ1dHRvbikge1xyXG4gICAgcmVzZXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgY29tbW9ucy5fX2RlbGV0ZVN0b3JhZ2UoKV07XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGNvbW1vbnMuY2xvc2VQcmV2aW91c2x5VW5jbG9zZWRUYWJzKCldO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBjb21tb25zLnVwZGF0ZU9wZW5UYWJzKCldO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFibGVCb2R5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZUJvZHkuaW5uZXJIVE1MID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYWluKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG4vKipUb2dnbGVzIHRoZSBzb3J0IG9yZGVyICovXHJcbmZ1bmN0aW9uIHRvZ2dsZVNvcnRPcmRlcigpIHtcclxuICAgIHZhciBzb3J0T3JkZXIgPSB0YWJsZUJvZHkuZ2V0QXR0cmlidXRlKFwiZGF0YS1zb3J0LW9yZGVyXCIpO1xyXG4gICAgaWYgKHNvcnRPcmRlciA9PSBcImFzY1wiKSB7XHJcbiAgICAgICAgc29ydE9yZGVyID0gXCJkZXNjXCI7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBzb3J0T3JkZXIgPSBcImFzY1wiO1xyXG4gICAgfVxyXG4gICAgdGFibGVCb2R5LnNldEF0dHJpYnV0ZShcImRhdGEtc29ydC1vcmRlclwiLCBzb3J0T3JkZXIpO1xyXG4gICAgcmV0dXJuIHNvcnRPcmRlcjtcclxufVxyXG5zb3J0QnlEb21haW5CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHNvcnRPcmRlcjtcclxuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICB0YWJsZUJvZHkuc2V0QXR0cmlidXRlKFwiZGF0YS1zb3J0LWJ5XCIsIFwiZG9tYWluXCIpO1xyXG4gICAgICAgICAgICBzb3J0T3JkZXIgPSB0b2dnbGVTb3J0T3JkZXIoKTtcclxuICAgICAgICAgICAgYXR0YWNoQXJyb3codGhpcywgc29ydE9yZGVyLCBcIkRvbWFpblwiKTtcclxuICAgICAgICAgICAgbWFpbigpO1xyXG4gICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7XHJcbnNvcnRCeUR1cmF0aW9uQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2dCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBzb3J0T3JkZXI7XHJcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdGFibGVCb2R5LnNldEF0dHJpYnV0ZShcImRhdGEtc29ydC1ieVwiLCBcImR1cmF0aW9uXCIpO1xyXG4gICAgICAgICAgICBzb3J0T3JkZXIgPSB0b2dnbGVTb3J0T3JkZXIoKTtcclxuICAgICAgICAgICAgYXR0YWNoQXJyb3codGhpcywgc29ydE9yZGVyLCBcIkR1cmF0aW9uXCIpO1xyXG4gICAgICAgICAgICBtYWluKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTtcclxuc29ydEJ5U3RhdHVzQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2dCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBzb3J0T3JkZXI7XHJcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdGFibGVCb2R5LnNldEF0dHJpYnV0ZShcImRhdGEtc29ydC1ieVwiLCBcImFjdGl2ZVwiKTtcclxuICAgICAgICAgICAgc29ydE9yZGVyID0gdG9nZ2xlU29ydE9yZGVyKCk7XHJcbiAgICAgICAgICAgIC8qKkNvcHkgZnJvbSBoZXJlICovXHJcbiAgICAgICAgICAgIGF0dGFjaEFycm93KHRoaXMsIHNvcnRPcmRlciwgXCJTdGF0dXNcIik7XHJcbiAgICAgICAgICAgIC8qKlVudGlsIGhlcmUgKi9cclxuICAgICAgICAgICAgbWFpbigpO1xyXG4gICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7XHJcbmZ1bmN0aW9uIGF0dGFjaEFycm93KHRoLCBzb3J0T3JkZXIsIHR5cGUpIHtcclxuICAgIHZhciBpID0gdGgucGFyZW50RWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImlcIilbMF07XHJcbiAgICBpZiAoc29ydE9yZGVyID09IFwiYXNjXCIpIHtcclxuICAgICAgICBpLmNsYXNzTmFtZSA9IFwiZmEgZmEtYXJyb3ctdXBcIjtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGkuY2xhc3NOYW1lID0gXCJmYSBmYS1hcnJvdy1kb3duXCI7XHJcbiAgICB9XHJcbiAgICAvLyBSZW1vdmUgaXQgZnJvbSB0aGUgY3VycmVudCBsb2NhdGlvblxyXG4gICAgdmFyIHBhcmVudEVsID0gaS5wYXJlbnRFbGVtZW50O1xyXG4gICAgcGFyZW50RWwucmVtb3ZlQ2hpbGQoaSk7XHJcbiAgICAvLyBBcHBlbmQgaXRcclxuICAgIHRoLmlubmVySFRNTCA9IFwiXCI7XHJcbiAgICB0aC5pbnNlcnRBZGphY2VudEhUTUwoXCJhZnRlcmJlZ2luXCIsIGkub3V0ZXJIVE1MICsgdHlwZSk7XHJcbn1cclxuLyoqTWFpbiBydW5uZXIgKi9cclxuZnVuY3Rpb24gbWFpbigpIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgdGVtcHVzT2JqZWN0LCBzb3J0T3JkZXIsIHNvcnRCeTtcclxuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgY29tbW9ucy5mZXRjaFRlbXB1c09iamVjdCgpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wdXNPYmplY3QgPSBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc29ydE9yZGVyID0gdGFibGVCb2R5LmdldEF0dHJpYnV0ZShcImRhdGEtc29ydC1vcmRlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICBzb3J0QnkgPSB0YWJsZUJvZHkuZ2V0QXR0cmlidXRlKFwiZGF0YS1zb3J0LWJ5XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFNvcnQgYnkgQWN0aXZlXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcHVzT2JqZWN0LnRlbXB1c0FycmF5LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNvcnRCeSA9PSBcImR1cmF0aW9uXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzb3J0QnlEdXJhdGlvbihhLCBiLCBzb3J0T3JkZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNvcnRCeSA9PSBcImRvbWFpblwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc29ydEJ5RG9tYWluKGEsIGIsIHNvcnRPcmRlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNvcnRCeUFjdGl2ZShhLCBiLCBzb3J0T3JkZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlbmRlclRhYmxlKHRlbXB1c09iamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG4vKipTb3J0cyB0aGUgdGVtcHVzQXJyYXkgYnkgRG9tYWluICovXHJcbmZ1bmN0aW9uIHNvcnRCeURvbWFpbihhLCBiLCBvcmRlcikge1xyXG4gICAgaWYgKCFvcmRlcikge1xyXG4gICAgICAgIG9yZGVyID0gJ2FzYyc7XHJcbiAgICB9XHJcbiAgICBpZiAoYS5kb21haW4gPiBiLmRvbWFpbikge1xyXG4gICAgICAgIGlmIChvcmRlciA9PSBcImFzY1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChvcmRlciA9PSBcImFzY1wiKSB7XHJcbiAgICAgICAgcmV0dXJuIDE7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gLTE7XHJcbn1cclxuLyoqU29ydHMgdGhlIHRlbXB1c0FycmF5IGJ5IER1cmF0aW9uICovXHJcbmZ1bmN0aW9uIHNvcnRCeUR1cmF0aW9uKGEsIGIsIG9yZGVyKSB7XHJcbiAgICBpZiAoIW9yZGVyKSB7XHJcbiAgICAgICAgb3JkZXIgPSAnYXNjJztcclxuICAgIH1cclxuICAgIGlmIChhLmxhcHNlZCA+IGIubGFwc2VkKSB7XHJcbiAgICAgICAgaWYgKG9yZGVyID09IFwiYXNjXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKG9yZGVyID09IFwiYXNjXCIpIHtcclxuICAgICAgICByZXR1cm4gMTtcclxuICAgIH1cclxuICAgIHJldHVybiAtMTtcclxufVxyXG4vKipTb3J0cyB0aGUgdGVtcHVzQXJyYXkgYnkgQUNUSVZFICovXHJcbmZ1bmN0aW9uIHNvcnRCeUFjdGl2ZShhLCBiLCBvcmRlcikge1xyXG4gICAgaWYgKCFvcmRlcikge1xyXG4gICAgICAgIG9yZGVyID0gJ2FzYyc7XHJcbiAgICB9XHJcbiAgICBpZiAoYS5hY3RpdmUgPiBiLmFjdGl2ZSkge1xyXG4gICAgICAgIGlmIChvcmRlciA9PSBcImFzY1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChvcmRlciA9PSBcImFzY1wiKSB7XHJcbiAgICAgICAgcmV0dXJuIDE7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gLTE7XHJcbn1cclxuLyoqUmVuZGVycyB0aGUgdGFibGUgZGlzcGxheWluZyB0aGUgZG9tYWluIGFuZCBkdXJhdGlvbiAqL1xyXG5mdW5jdGlvbiByZW5kZXJUYWJsZSh0ZW1wdXNPYmplY3QpIHtcclxuICAgIHZhciB0YWJsZUJvZHlTdHJpbmcgPSAnJztcclxuICAgIHRlbXB1c09iamVjdC50ZW1wdXNBcnJheS5mb3JFYWNoKGZ1bmN0aW9uICh0ZW1wdXMpIHtcclxuICAgICAgICB0YWJsZUJvZHlTdHJpbmcgKz0gXCJcXG4gICAgICAgIDx0ciBjbGFzcz0nXCIgKyByZXR1cm5Sb3dDbGFzcyh0ZW1wdXMuYWN0aXZlKSArIFwiJz5cXG4gICAgICAgICAgICA8dGQ+XCIgKyB0ZW1wdXMuZG9tYWluICsgXCI8L3RkPlxcbiAgICAgICAgICAgIDx0ZD5cIiArIHJldHVyblRpbWVMYXBzZWQodGVtcHVzLmxhcHNlZCkgKyBcIjwvdGQ+XFxuICAgICAgICAgICAgPHRkPlwiICsgcmV0dXJuQWN0aXZlU3RhdHVzKHRlbXB1cy5hY3RpdmUpICsgXCI8L3RkPlxcbiAgICAgICAgPC90cj5cXG4gICAgICAgIFwiO1xyXG4gICAgfSk7XHJcbiAgICAvLyA8dGQ+JHtNYXRoLnJvdW5kKHRlbXB1cy5sYXBzZWQgLyAxMDAwKX1zPC90ZD5cclxuICAgIGlmICh0YWJsZUJvZHkpIHtcclxuICAgICAgICB0YWJsZUJvZHkuaW5uZXJIVE1MID0gdGFibGVCb2R5U3RyaW5nO1xyXG4gICAgfVxyXG59XHJcbi8qKlJldHVybnMgdGhlIGFjdGl2ZSBjbGFzcyBjb2xvciBkZXBlbmRpbmcgb24gdGhlIHN0YXR1cyAqL1xyXG5mdW5jdGlvbiByZXR1cm5Sb3dDbGFzcyhhY3RpdmUpIHtcclxuICAgIGlmIChhY3RpdmUpIHtcclxuICAgICAgICByZXR1cm4gJ2dyZWVuJztcclxuICAgIH1cclxuICAgIHJldHVybiAnJztcclxufVxyXG4vKipSZXR1cm5zIHRoZSB0aW1lIGxhcHNlZCBpbiB0aGUgZm9sbG93aW5nIGZvcm1hdDpcclxuICogSWYgbGVzcyB0aGFuIDEgbWluLCBmb3JtYXQgd2lsbCBiZSBYc1xyXG4gKiBJZiBncmVhdGVyIHRoYW4gMSBtaW4gYW5kIGxlc3MgdGhhbiAxIGhvdXIsIGZvcm1hdCB3aWxsIGJlIFhYOllZbVxyXG4gKiBPdGhlcndpc2UsIHdpbGwgYmUgWFg6WVk6WlpoICovXHJcbmZ1bmN0aW9uIHJldHVyblRpbWVMYXBzZWQobGFwc2VkKSB7XHJcbiAgICBpZiAobGFwc2VkIDwgbWludXRlKSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobGFwc2VkIC8gc2Vjb25kKS50b1N0cmluZygpICsgXCJzXCI7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChsYXBzZWQgPCBob3VyKSB7XHJcbiAgICAgICAgcmV0dXJuIHBhZChNYXRoLnJvdW5kKGxhcHNlZCAvIG1pbnV0ZSkpLnRvU3RyaW5nKCkgKyBcIjpcIiArIHBhZChNYXRoLnJvdW5kKChsYXBzZWQgJSBtaW51dGUpIC8gc2Vjb25kKSkudG9TdHJpbmcoKSArIFwibVwiO1xyXG4gICAgfVxyXG4gICAgdmFyIGggPSBNYXRoLnJvdW5kKGxhcHNlZCAvIGhvdXIpO1xyXG4gICAgdmFyIG0gPSBNYXRoLnJvdW5kKGxhcHNlZCAlIGgpO1xyXG4gICAgdmFyIHMgPSBNYXRoLnJvdW5kKChtICUgbWludXRlKSAvIHNlY29uZCk7XHJcbiAgICBtID0gTWF0aC5yb3VuZChtIC8gbWludXRlKTtcclxuICAgIHJldHVybiBwYWQoaCkudG9TdHJpbmcoKSArIFwiOlwiICsgcGFkKG0pLnRvU3RyaW5nKCkgKyBcIjpcIiArIHBhZChzKS50b1N0cmluZygpICsgXCJoXCI7XHJcbn1cclxuLyoqUmV0dXJucyB0aGUgQUNUSVZFIHN0YXRlICovXHJcbmZ1bmN0aW9uIHJldHVybkFjdGl2ZVN0YXR1cyhhY3RpdmUpIHtcclxuICAgIGlmIChhY3RpdmUpIHtcclxuICAgICAgICByZXR1cm4gXCJBY3RpdmVcIjtcclxuICAgIH1cclxuICAgIHJldHVybiBcIkluYWN0aXZlXCI7XHJcbn1cclxuLyoqUmV0dXJucyBhIHBhZGRlZCBudW1iZXIgKi9cclxuZnVuY3Rpb24gcGFkKG4pIHtcclxuICAgIHJldHVybiBuIDwgMTAgPyAnMCcgKyBuIDogbjtcclxufVxyXG5tYWluKCk7XHJcbnNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgIG1haW4oKTtcclxufSwgMjAwMCk7XHJcbiJdfQ=="}