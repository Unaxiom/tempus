{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/js/commons.js","src/js/ui.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9aA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ui.src.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**Stores the list of URLs */\r\nexports.tempusObjectID = \"tempusArray\";\r\nexports.tempusRefresherID = \"tempusRefresher\";\r\nexports.refreshDelayInMins = (1 / 60);\r\nvar refreshDelayInMilliSeconds = exports.refreshDelayInMins * 60 * 1000;\r\nexports.refreshAlarm = \"Alarm\";\r\nvar firefoxBrowser = 'firefox';\r\nvar chromeBrowser = 'chrome';\r\nvar browserName;\r\nif (navigator.userAgent.indexOf(\"Chrome\") > -1) {\r\n    browserName = chromeBrowser;\r\n}\r\nelse {\r\n    browserName = firefoxBrowser;\r\n}\r\n// let browser = chrome;\r\n/**Retrieves the storage value */\r\nfunction getStorage() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!(browserName == firefoxBrowser)) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, browser.storage.local.get()];\r\n                case 1: return [2 /*return*/, _a.sent()];\r\n                case 2: return [2 /*return*/, {}];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**Sets the storage */\r\nfunction setStorage(storageObject) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!(browserName == firefoxBrowser)) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, browser.storage.local.set(storageObject)];\r\n                case 1:\r\n                    _a.sent();\r\n                    _a.label = 2;\r\n                case 2: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**Clears the storage */\r\nfunction clearStorage() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!(browserName == firefoxBrowser)) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, browser.storage.local.clear()];\r\n                case 1:\r\n                    _a.sent();\r\n                    _a.label = 2;\r\n                case 2: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**Adds an alarm to the appropriate browser */\r\nfunction createBrowserAlarm(alarmName, obj, listener) {\r\n    if (browserName == firefoxBrowser) {\r\n        browser.alarms.create(alarmName, obj);\r\n        browser.alarms.onAlarm.addListener(listener);\r\n    }\r\n}\r\n/**Clears the browser alarm */\r\nfunction clearBrowserAlarm(alarmName) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!(browserName == firefoxBrowser)) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, browser.alarms.clear(alarmName)];\r\n                case 1:\r\n                    _a.sent();\r\n                    _a.label = 2;\r\n                case 2: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**Returns all the browser tabs on the basis of the query object */\r\nfunction queryBrowserTabs(obj) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!(browserName == firefoxBrowser)) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, browser.tabs.query(obj)];\r\n                case 1: return [2 /*return*/, _a.sent()];\r\n                case 2: return [2 /*return*/, []];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**Returns the tempus object */\r\nfunction fetchTempusObject() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var storageObject;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getStorage()];\r\n                case 1:\r\n                    storageObject = _a.sent();\r\n                    if (!!storageObject[exports.tempusObjectID]) return [3 /*break*/, 3];\r\n                    storageObject[exports.tempusObjectID] = {\r\n                        id: exports.tempusObjectID,\r\n                        tempusArray: []\r\n                    };\r\n                    // Write the object to the storage\r\n                    return [4 /*yield*/, setStorage(storageObject)];\r\n                case 2:\r\n                    // Write the object to the storage\r\n                    _a.sent();\r\n                    _a.label = 3;\r\n                case 3: return [4 /*yield*/, getStorage()];\r\n                case 4:\r\n                    storageObject = _a.sent();\r\n                    return [2 /*return*/, storageObject[exports.tempusObjectID]];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.fetchTempusObject = fetchTempusObject;\r\n/**Returns the tempus refresher object */\r\nfunction fetchTempusRefresher() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var storageObject;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getStorage()];\r\n                case 1:\r\n                    storageObject = _a.sent();\r\n                    if (!!storageObject[exports.tempusRefresherID]) return [3 /*break*/, 3];\r\n                    storageObject[exports.tempusRefresherID] = {\r\n                        id: exports.tempusRefresherID,\r\n                        refreshed_at: 0\r\n                    };\r\n                    // Write the object to the storage\r\n                    return [4 /*yield*/, setStorage(storageObject)];\r\n                case 2:\r\n                    // Write the object to the storage\r\n                    _a.sent();\r\n                    _a.label = 3;\r\n                case 3: return [4 /*yield*/, getStorage()];\r\n                case 4:\r\n                    storageObject = _a.sent();\r\n                    return [2 /*return*/, storageObject[exports.tempusRefresherID]];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.fetchTempusRefresher = fetchTempusRefresher;\r\n/**Checks if there are any unclosed tabs and closes them */\r\nfunction closePreviouslyUnclosedTabs() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tempusObject, tempusRefresher, currentTimestamp, timeDelay;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, fetchTempusObject()];\r\n                case 1:\r\n                    tempusObject = _a.sent();\r\n                    return [4 /*yield*/, fetchTempusRefresher()];\r\n                case 2:\r\n                    tempusRefresher = _a.sent();\r\n                    currentTimestamp = new Date().getTime();\r\n                    if (tempusRefresher.refreshed_at <= 0) {\r\n                        // This is the first time this is running\r\n                        return [2 /*return*/];\r\n                    }\r\n                    timeDelay = currentTimestamp - tempusRefresher.refreshed_at;\r\n                    /* Iterate over all the available tempus objects and set their active to false,\r\n                    /* and increase their duration by refreshDelayInMins * 6000\r\n                    */\r\n                    tempusObject.tempusArray.forEach(function (tempusStruct) {\r\n                        if (tempusStruct.active) {\r\n                            tempusStruct.active = false;\r\n                            if (timeDelay > refreshDelayInMilliSeconds) {\r\n                                // If time delay is greater, then the max increment can be the refresh delay\r\n                                tempusStruct.lapsed += refreshDelayInMilliSeconds;\r\n                            }\r\n                            else {\r\n                                // If time delay is lower, then set it to time delay\r\n                                tempusStruct.lapsed += timeDelay;\r\n                            }\r\n                        }\r\n                    });\r\n                    return [4 /*yield*/, storeTempusObject(tempusObject)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, storeTempusRefresher(tempusRefresher)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.closePreviouslyUnclosedTabs = closePreviouslyUnclosedTabs;\r\n/**Returns domain from a passed URL */\r\nfunction returnDomainFromURL(url) {\r\n    var domain = '';\r\n    if (!url) {\r\n        return domain;\r\n    }\r\n    if (url.startsWith(\"http\")) {\r\n        var temp = url.split(\"//\");\r\n        domain = temp[0] + \"//\" + temp[1].split(\"/\")[0];\r\n    }\r\n    else {\r\n        domain = url;\r\n    }\r\n    return domain;\r\n}\r\nexports.returnDomainFromURL = returnDomainFromURL;\r\n/**Stores the tempus object in the storage */\r\nfunction storeTempusObject(obj) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var localObj;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    localObj = {};\r\n                    localObj[exports.tempusObjectID] = obj;\r\n                    return [4 /*yield*/, setStorage(localObj)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.storeTempusObject = storeTempusObject;\r\n/**Stores the tempus refresher in the storage */\r\nfunction storeTempusRefresher(obj) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var localObj;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    localObj = {};\r\n                    localObj[exports.tempusRefresherID] = obj;\r\n                    return [4 /*yield*/, setStorage(localObj)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.storeTempusRefresher = storeTempusRefresher;\r\n/**Updates all the open tabs */\r\nfunction updateOpenTabs() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tabs, tempusObject, tempusRefresher, tempusArrayDomains, j, obj;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, queryBrowserTabs({})];\r\n                case 1:\r\n                    tabs = _a.sent();\r\n                    return [4 /*yield*/, fetchTempusObject()];\r\n                case 2:\r\n                    tempusObject = _a.sent();\r\n                    return [4 /*yield*/, fetchTempusRefresher()];\r\n                case 3:\r\n                    tempusRefresher = _a.sent();\r\n                    tempusArrayDomains = [];\r\n                    for (j = 0; j < tempusObject.tempusArray.length; j++) {\r\n                        obj = tempusObject.tempusArray[j];\r\n                        tempusArrayDomains.push(obj.domain);\r\n                    }\r\n                    // If any of the tabsDomains do not have an entry in tempusArrayDomains, then add it to the list\r\n                    tabs.forEach(function (tab) {\r\n                        if (tab.url) {\r\n                            var domain = returnDomainFromURL(tab.url);\r\n                            var index = tempusArrayDomains.indexOf(domain);\r\n                            if (index == -1) {\r\n                                tempusObject.tempusArray.push({\r\n                                    active: tab.active,\r\n                                    domain: domain,\r\n                                    activatedAt: new Date().getTime(),\r\n                                    lapsed: 0\r\n                                });\r\n                            }\r\n                            else {\r\n                                // Set the tab to active\r\n                                if (tab.active) {\r\n                                    var el = tempusObject.tempusArray[index];\r\n                                    el.active = tab.active;\r\n                                    tempusObject.tempusArray.splice(index, 1, el);\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                    return [4 /*yield*/, storeTempusObject(tempusObject)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.updateOpenTabs = updateOpenTabs;\r\n// Alarms\r\n/**Creates the alarm */\r\nfunction createAlarm() {\r\n    createBrowserAlarm(exports.refreshAlarm, { delayInMinutes: exports.refreshDelayInMins }, refreshTimestamp);\r\n}\r\n/**Resets the alarms */\r\nfunction resetAlarm() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, clearBrowserAlarm(exports.refreshAlarm)];\r\n                case 1:\r\n                    _a.sent();\r\n                    createAlarm();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**Event handler that handles the alarm fire */\r\nfunction refreshTimestamp() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tempusRefresher, tempusObject;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, fetchTempusRefresher()];\r\n                case 1:\r\n                    tempusRefresher = _a.sent();\r\n                    tempusRefresher.refreshed_at = new Date().getTime();\r\n                    return [4 /*yield*/, storeTempusRefresher(tempusRefresher)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, fetchTempusObject()];\r\n                case 3:\r\n                    tempusObject = _a.sent();\r\n                    tempusObject.tempusArray.forEach(function (tempusStruct) {\r\n                        if (tempusStruct.active) {\r\n                            tempusStruct.lapsed += tempusRefresher.refreshed_at - tempusStruct.activatedAt;\r\n                            tempusStruct.activatedAt = tempusRefresher.refreshed_at;\r\n                        }\r\n                    });\r\n                    return [4 /*yield*/, storeTempusObject(tempusObject)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, resetAlarm()];\r\n                case 5:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**Handle the first run */\r\nfunction onFirstLoad() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, closePreviouslyUnclosedTabs()];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, updateOpenTabs()];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, resetAlarm()];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.onFirstLoad = onFirstLoad;\r\n/**Deletes the storage */\r\nfunction __deleteStorage() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, clearStorage()];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.__deleteStorage = __deleteStorage;\r\n","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar commons = require(\"./commons\");\r\nvar tableBody = document.getElementById(\"tbody\");\r\nvar resetButton = document.getElementById(\"reset-button\");\r\nvar sortByDomainButton = document.getElementById(\"sort-by-domain\");\r\nvar sortByDurationButton = document.getElementById(\"sort-by-duration\");\r\nvar sortByStatusButton = document.getElementById(\"sort-by-active\");\r\nvar millisecond = 1;\r\nvar second = 1000 * millisecond;\r\nvar minute = 60 * second;\r\nvar hour = 60 * minute;\r\nif (resetButton) {\r\n    resetButton.addEventListener('click', function (evt) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        evt.preventDefault();\r\n                        return [4 /*yield*/, commons.__deleteStorage()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, commons.closePreviouslyUnclosedTabs()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, commons.updateOpenTabs()];\r\n                    case 3:\r\n                        _a.sent();\r\n                        if (tableBody) {\r\n                            tableBody.innerHTML = \"\";\r\n                        }\r\n                        main();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    });\r\n}\r\n/**Toggles the sort order */\r\nfunction toggleSortOrder() {\r\n    var sortOrder = tableBody.getAttribute(\"data-sort-order\");\r\n    if (sortOrder == \"asc\") {\r\n        sortOrder = \"desc\";\r\n    }\r\n    else {\r\n        sortOrder = \"asc\";\r\n    }\r\n    tableBody.setAttribute(\"data-sort-order\", sortOrder);\r\n    return sortOrder;\r\n}\r\nsortByDomainButton.addEventListener('click', function (evt) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var sortOrder;\r\n        return __generator(this, function (_a) {\r\n            evt.preventDefault();\r\n            tableBody.setAttribute(\"data-sort-by\", \"domain\");\r\n            sortOrder = toggleSortOrder();\r\n            attachArrow(this, sortOrder, \"Domain\");\r\n            main();\r\n            return [2 /*return*/];\r\n        });\r\n    });\r\n});\r\nsortByDurationButton.addEventListener('click', function (evt) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var sortOrder;\r\n        return __generator(this, function (_a) {\r\n            evt.preventDefault();\r\n            tableBody.setAttribute(\"data-sort-by\", \"duration\");\r\n            sortOrder = toggleSortOrder();\r\n            attachArrow(this, sortOrder, \"Duration\");\r\n            main();\r\n            return [2 /*return*/];\r\n        });\r\n    });\r\n});\r\nsortByStatusButton.addEventListener('click', function (evt) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var sortOrder;\r\n        return __generator(this, function (_a) {\r\n            evt.preventDefault();\r\n            tableBody.setAttribute(\"data-sort-by\", \"active\");\r\n            sortOrder = toggleSortOrder();\r\n            /**Copy from here */\r\n            attachArrow(this, sortOrder, \"Status\");\r\n            /**Until here */\r\n            main();\r\n            return [2 /*return*/];\r\n        });\r\n    });\r\n});\r\nfunction attachArrow(th, sortOrder, type) {\r\n    var i = th.parentElement.getElementsByTagName(\"i\")[0];\r\n    if (sortOrder == \"asc\") {\r\n        i.className = \"fa fa-arrow-up\";\r\n    }\r\n    else {\r\n        i.className = \"fa fa-arrow-down\";\r\n    }\r\n    // Remove it from the current location\r\n    var parentEl = i.parentElement;\r\n    parentEl.removeChild(i);\r\n    // Append it\r\n    th.innerHTML = \"\";\r\n    th.insertAdjacentHTML(\"afterbegin\", i.outerHTML + type);\r\n}\r\n/**Main runner */\r\nfunction main() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tempusObject, sortOrder, sortBy;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, commons.fetchTempusObject()];\r\n                case 1:\r\n                    tempusObject = _a.sent();\r\n                    sortOrder = tableBody.getAttribute(\"data-sort-order\");\r\n                    sortBy = tableBody.getAttribute(\"data-sort-by\");\r\n                    // Sort by Active\r\n                    tempusObject.tempusArray.sort(function (a, b) {\r\n                        if (sortBy == \"duration\") {\r\n                            return sortByDuration(a, b, sortOrder);\r\n                        }\r\n                        else if (sortBy == \"domain\") {\r\n                            return sortByDomain(a, b, sortOrder);\r\n                        }\r\n                        return sortByActive(a, b, sortOrder);\r\n                    });\r\n                    renderTable(tempusObject);\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**Sorts the tempusArray by Domain */\r\nfunction sortByDomain(a, b, order) {\r\n    if (!order) {\r\n        order = 'asc';\r\n    }\r\n    if (a.domain > b.domain) {\r\n        if (order == \"asc\") {\r\n            return -1;\r\n        }\r\n        else {\r\n            return 1;\r\n        }\r\n    }\r\n    if (order == \"asc\") {\r\n        return 1;\r\n    }\r\n    return -1;\r\n}\r\n/**Sorts the tempusArray by Duration */\r\nfunction sortByDuration(a, b, order) {\r\n    if (!order) {\r\n        order = 'asc';\r\n    }\r\n    if (a.lapsed > b.lapsed) {\r\n        if (order == \"asc\") {\r\n            return -1;\r\n        }\r\n        else {\r\n            return 1;\r\n        }\r\n    }\r\n    if (order == \"asc\") {\r\n        return 1;\r\n    }\r\n    return -1;\r\n}\r\n/**Sorts the tempusArray by ACTIVE */\r\nfunction sortByActive(a, b, order) {\r\n    if (!order) {\r\n        order = 'asc';\r\n    }\r\n    if (a.active > b.active) {\r\n        if (order == \"asc\") {\r\n            return -1;\r\n        }\r\n        else {\r\n            return 1;\r\n        }\r\n    }\r\n    if (order == \"asc\") {\r\n        return 1;\r\n    }\r\n    return -1;\r\n}\r\n/**Renders the table displaying the domain and duration */\r\nfunction renderTable(tempusObject) {\r\n    var tableBodyString = '';\r\n    tempusObject.tempusArray.forEach(function (tempus) {\r\n        tableBodyString += \"\\n        <tr class='\" + returnRowClass(tempus.active) + \"'>\\n            <td>\" + tempus.domain + \"</td>\\n            <td>\" + returnTimeLapsed(tempus.lapsed) + \"</td>\\n            <td>\" + returnActiveStatus(tempus.active) + \"</td>\\n        </tr>\\n        \";\r\n    });\r\n    // <td>${Math.round(tempus.lapsed / 1000)}s</td>\r\n    if (tableBody) {\r\n        tableBody.innerHTML = tableBodyString;\r\n    }\r\n}\r\n/**Returns the active class color depending on the status */\r\nfunction returnRowClass(active) {\r\n    if (active) {\r\n        return 'green';\r\n    }\r\n    return '';\r\n}\r\n/**Returns the time lapsed in the following format:\r\n * If less than 1 min, format will be Xs\r\n * If greater than 1 min and less than 1 hour, format will be XX:YYm\r\n * Otherwise, will be XX:YY:ZZh */\r\nfunction returnTimeLapsed(lapsed) {\r\n    if (lapsed < minute) {\r\n        return Math.round(lapsed / second).toString() + \"s\";\r\n    }\r\n    else if (lapsed < hour) {\r\n        return pad(Math.round(lapsed / minute)).toString() + \":\" + pad(Math.round((lapsed % minute) / second)).toString() + \"m\";\r\n    }\r\n    var h = Math.round(lapsed / hour);\r\n    var m = Math.round(lapsed % h);\r\n    var s = Math.round((m % minute) / second);\r\n    m = Math.round(m / minute);\r\n    return pad(h).toString() + \":\" + pad(m).toString() + \":\" + pad(s).toString() + \"h\";\r\n}\r\n/**Returns the ACTIVE state */\r\nfunction returnActiveStatus(active) {\r\n    if (active) {\r\n        return \"Active\";\r\n    }\r\n    return \"Inactive\";\r\n}\r\n/**Returns a padded number */\r\nfunction pad(n) {\r\n    return n < 10 ? '0' + n : n;\r\n}\r\nmain();\r\nsetInterval(function () {\r\n    main();\r\n}, 2000);\r\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvY29tbW9ucy5qcyIsInNyYy9qcy91aS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOWFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxudmFyIF9fZ2VuZXJhdG9yID0gKHRoaXMgJiYgdGhpcy5fX2dlbmVyYXRvcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIGJvZHkpIHtcclxuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XHJcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xyXG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcclxuICAgICAgICB3aGlsZSAoXykgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0geVtvcFswXSAmIDIgPyBcInJldHVyblwiIDogb3BbMF0gPyBcInRocm93XCIgOiBcIm5leHRcIl0pICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xyXG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gWzAsIHQudmFsdWVdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cclxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcclxuICAgIH1cclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4vKipTdG9yZXMgdGhlIGxpc3Qgb2YgVVJMcyAqL1xyXG5leHBvcnRzLnRlbXB1c09iamVjdElEID0gXCJ0ZW1wdXNBcnJheVwiO1xyXG5leHBvcnRzLnRlbXB1c1JlZnJlc2hlcklEID0gXCJ0ZW1wdXNSZWZyZXNoZXJcIjtcclxuZXhwb3J0cy5yZWZyZXNoRGVsYXlJbk1pbnMgPSAoMSAvIDYwKTtcclxudmFyIHJlZnJlc2hEZWxheUluTWlsbGlTZWNvbmRzID0gZXhwb3J0cy5yZWZyZXNoRGVsYXlJbk1pbnMgKiA2MCAqIDEwMDA7XHJcbmV4cG9ydHMucmVmcmVzaEFsYXJtID0gXCJBbGFybVwiO1xyXG52YXIgZmlyZWZveEJyb3dzZXIgPSAnZmlyZWZveCc7XHJcbnZhciBjaHJvbWVCcm93c2VyID0gJ2Nocm9tZSc7XHJcbnZhciBicm93c2VyTmFtZTtcclxuaWYgKG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIkNocm9tZVwiKSA+IC0xKSB7XHJcbiAgICBicm93c2VyTmFtZSA9IGNocm9tZUJyb3dzZXI7XHJcbn1cclxuZWxzZSB7XHJcbiAgICBicm93c2VyTmFtZSA9IGZpcmVmb3hCcm93c2VyO1xyXG59XHJcbi8vIGxldCBicm93c2VyID0gY2hyb21lO1xyXG4vKipSZXRyaWV2ZXMgdGhlIHN0b3JhZ2UgdmFsdWUgKi9cclxuZnVuY3Rpb24gZ2V0U3RvcmFnZSgpIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIShicm93c2VyTmFtZSA9PSBmaXJlZm94QnJvd3NlcikpIHJldHVybiBbMyAvKmJyZWFrKi8sIDJdO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGJyb3dzZXIuc3RvcmFnZS5sb2NhbC5nZXQoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6IHJldHVybiBbMiAvKnJldHVybiovLCBfYS5zZW50KCldO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAyOiByZXR1cm4gWzIgLypyZXR1cm4qLywge31dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG4vKipTZXRzIHRoZSBzdG9yYWdlICovXHJcbmZ1bmN0aW9uIHNldFN0b3JhZ2Uoc3RvcmFnZU9iamVjdCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKGJyb3dzZXJOYW1lID09IGZpcmVmb3hCcm93c2VyKSkgcmV0dXJuIFszIC8qYnJlYWsqLywgMl07XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgYnJvd3Nlci5zdG9yYWdlLmxvY2FsLnNldChzdG9yYWdlT2JqZWN0KV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMjtcclxuICAgICAgICAgICAgICAgIGNhc2UgMjogcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG4vKipDbGVhcnMgdGhlIHN0b3JhZ2UgKi9cclxuZnVuY3Rpb24gY2xlYXJTdG9yYWdlKCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKGJyb3dzZXJOYW1lID09IGZpcmVmb3hCcm93c2VyKSkgcmV0dXJuIFszIC8qYnJlYWsqLywgMl07XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgYnJvd3Nlci5zdG9yYWdlLmxvY2FsLmNsZWFyKCldO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDI7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDI6IHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuLyoqQWRkcyBhbiBhbGFybSB0byB0aGUgYXBwcm9wcmlhdGUgYnJvd3NlciAqL1xyXG5mdW5jdGlvbiBjcmVhdGVCcm93c2VyQWxhcm0oYWxhcm1OYW1lLCBvYmosIGxpc3RlbmVyKSB7XHJcbiAgICBpZiAoYnJvd3Nlck5hbWUgPT0gZmlyZWZveEJyb3dzZXIpIHtcclxuICAgICAgICBicm93c2VyLmFsYXJtcy5jcmVhdGUoYWxhcm1OYW1lLCBvYmopO1xyXG4gICAgICAgIGJyb3dzZXIuYWxhcm1zLm9uQWxhcm0uYWRkTGlzdGVuZXIobGlzdGVuZXIpO1xyXG4gICAgfVxyXG59XHJcbi8qKkNsZWFycyB0aGUgYnJvd3NlciBhbGFybSAqL1xyXG5mdW5jdGlvbiBjbGVhckJyb3dzZXJBbGFybShhbGFybU5hbWUpIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIShicm93c2VyTmFtZSA9PSBmaXJlZm94QnJvd3NlcikpIHJldHVybiBbMyAvKmJyZWFrKi8sIDJdO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGJyb3dzZXIuYWxhcm1zLmNsZWFyKGFsYXJtTmFtZSldO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDI7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDI6IHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuLyoqUmV0dXJucyBhbGwgdGhlIGJyb3dzZXIgdGFicyBvbiB0aGUgYmFzaXMgb2YgdGhlIHF1ZXJ5IG9iamVjdCAqL1xyXG5mdW5jdGlvbiBxdWVyeUJyb3dzZXJUYWJzKG9iaikge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKGJyb3dzZXJOYW1lID09IGZpcmVmb3hCcm93c2VyKSkgcmV0dXJuIFszIC8qYnJlYWsqLywgMl07XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgYnJvd3Nlci50YWJzLnF1ZXJ5KG9iaildO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAxOiByZXR1cm4gWzIgLypyZXR1cm4qLywgX2Euc2VudCgpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMjogcmV0dXJuIFsyIC8qcmV0dXJuKi8sIFtdXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuLyoqUmV0dXJucyB0aGUgdGVtcHVzIG9iamVjdCAqL1xyXG5mdW5jdGlvbiBmZXRjaFRlbXB1c09iamVjdCgpIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgc3RvcmFnZU9iamVjdDtcclxuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgZ2V0U3RvcmFnZSgpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICBzdG9yYWdlT2JqZWN0ID0gX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghIXN0b3JhZ2VPYmplY3RbZXhwb3J0cy50ZW1wdXNPYmplY3RJRF0pIHJldHVybiBbMyAvKmJyZWFrKi8sIDNdO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0b3JhZ2VPYmplY3RbZXhwb3J0cy50ZW1wdXNPYmplY3RJRF0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBleHBvcnRzLnRlbXB1c09iamVjdElELFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wdXNBcnJheTogW11cclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFdyaXRlIHRoZSBvYmplY3QgdG8gdGhlIHN0b3JhZ2VcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBzZXRTdG9yYWdlKHN0b3JhZ2VPYmplY3QpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICAvLyBXcml0ZSB0aGUgb2JqZWN0IHRvIHRoZSBzdG9yYWdlXHJcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMztcclxuICAgICAgICAgICAgICAgIGNhc2UgMzogcmV0dXJuIFs0IC8qeWllbGQqLywgZ2V0U3RvcmFnZSgpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNDpcclxuICAgICAgICAgICAgICAgICAgICBzdG9yYWdlT2JqZWN0ID0gX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBzdG9yYWdlT2JqZWN0W2V4cG9ydHMudGVtcHVzT2JqZWN0SURdXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuZXhwb3J0cy5mZXRjaFRlbXB1c09iamVjdCA9IGZldGNoVGVtcHVzT2JqZWN0O1xyXG4vKipSZXR1cm5zIHRoZSB0ZW1wdXMgcmVmcmVzaGVyIG9iamVjdCAqL1xyXG5mdW5jdGlvbiBmZXRjaFRlbXB1c1JlZnJlc2hlcigpIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgc3RvcmFnZU9iamVjdDtcclxuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgZ2V0U3RvcmFnZSgpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICBzdG9yYWdlT2JqZWN0ID0gX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghIXN0b3JhZ2VPYmplY3RbZXhwb3J0cy50ZW1wdXNSZWZyZXNoZXJJRF0pIHJldHVybiBbMyAvKmJyZWFrKi8sIDNdO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0b3JhZ2VPYmplY3RbZXhwb3J0cy50ZW1wdXNSZWZyZXNoZXJJRF0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBleHBvcnRzLnRlbXB1c1JlZnJlc2hlcklELFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoZWRfYXQ6IDBcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFdyaXRlIHRoZSBvYmplY3QgdG8gdGhlIHN0b3JhZ2VcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBzZXRTdG9yYWdlKHN0b3JhZ2VPYmplY3QpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICAvLyBXcml0ZSB0aGUgb2JqZWN0IHRvIHRoZSBzdG9yYWdlXHJcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMztcclxuICAgICAgICAgICAgICAgIGNhc2UgMzogcmV0dXJuIFs0IC8qeWllbGQqLywgZ2V0U3RvcmFnZSgpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNDpcclxuICAgICAgICAgICAgICAgICAgICBzdG9yYWdlT2JqZWN0ID0gX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBzdG9yYWdlT2JqZWN0W2V4cG9ydHMudGVtcHVzUmVmcmVzaGVySURdXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuZXhwb3J0cy5mZXRjaFRlbXB1c1JlZnJlc2hlciA9IGZldGNoVGVtcHVzUmVmcmVzaGVyO1xyXG4vKipDaGVja3MgaWYgdGhlcmUgYXJlIGFueSB1bmNsb3NlZCB0YWJzIGFuZCBjbG9zZXMgdGhlbSAqL1xyXG5mdW5jdGlvbiBjbG9zZVByZXZpb3VzbHlVbmNsb3NlZFRhYnMoKSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHRlbXB1c09iamVjdCwgdGVtcHVzUmVmcmVzaGVyLCBjdXJyZW50VGltZXN0YW1wLCB0aW1lRGVsYXk7XHJcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGZldGNoVGVtcHVzT2JqZWN0KCldO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXB1c09iamVjdCA9IF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBmZXRjaFRlbXB1c1JlZnJlc2hlcigpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wdXNSZWZyZXNoZXIgPSBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFRpbWVzdGFtcCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wdXNSZWZyZXNoZXIucmVmcmVzaGVkX2F0IDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgZmlyc3QgdGltZSB0aGlzIGlzIHJ1bm5pbmdcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aW1lRGVsYXkgPSBjdXJyZW50VGltZXN0YW1wIC0gdGVtcHVzUmVmcmVzaGVyLnJlZnJlc2hlZF9hdDtcclxuICAgICAgICAgICAgICAgICAgICAvKiBJdGVyYXRlIG92ZXIgYWxsIHRoZSBhdmFpbGFibGUgdGVtcHVzIG9iamVjdHMgYW5kIHNldCB0aGVpciBhY3RpdmUgdG8gZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgLyogYW5kIGluY3JlYXNlIHRoZWlyIGR1cmF0aW9uIGJ5IHJlZnJlc2hEZWxheUluTWlucyAqIDYwMDBcclxuICAgICAgICAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXB1c09iamVjdC50ZW1wdXNBcnJheS5mb3JFYWNoKGZ1bmN0aW9uICh0ZW1wdXNTdHJ1Y3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXB1c1N0cnVjdC5hY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXB1c1N0cnVjdC5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aW1lRGVsYXkgPiByZWZyZXNoRGVsYXlJbk1pbGxpU2Vjb25kcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRpbWUgZGVsYXkgaXMgZ3JlYXRlciwgdGhlbiB0aGUgbWF4IGluY3JlbWVudCBjYW4gYmUgdGhlIHJlZnJlc2ggZGVsYXlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wdXNTdHJ1Y3QubGFwc2VkICs9IHJlZnJlc2hEZWxheUluTWlsbGlTZWNvbmRzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGltZSBkZWxheSBpcyBsb3dlciwgdGhlbiBzZXQgaXQgdG8gdGltZSBkZWxheVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXB1c1N0cnVjdC5sYXBzZWQgKz0gdGltZURlbGF5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgc3RvcmVUZW1wdXNPYmplY3QodGVtcHVzT2JqZWN0KV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHN0b3JlVGVtcHVzUmVmcmVzaGVyKHRlbXB1c1JlZnJlc2hlcildO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OlxyXG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcbmV4cG9ydHMuY2xvc2VQcmV2aW91c2x5VW5jbG9zZWRUYWJzID0gY2xvc2VQcmV2aW91c2x5VW5jbG9zZWRUYWJzO1xyXG4vKipSZXR1cm5zIGRvbWFpbiBmcm9tIGEgcGFzc2VkIFVSTCAqL1xyXG5mdW5jdGlvbiByZXR1cm5Eb21haW5Gcm9tVVJMKHVybCkge1xyXG4gICAgdmFyIGRvbWFpbiA9ICcnO1xyXG4gICAgaWYgKCF1cmwpIHtcclxuICAgICAgICByZXR1cm4gZG9tYWluO1xyXG4gICAgfVxyXG4gICAgaWYgKHVybC5zdGFydHNXaXRoKFwiaHR0cFwiKSkge1xyXG4gICAgICAgIHZhciB0ZW1wID0gdXJsLnNwbGl0KFwiLy9cIik7XHJcbiAgICAgICAgZG9tYWluID0gdGVtcFswXSArIFwiLy9cIiArIHRlbXBbMV0uc3BsaXQoXCIvXCIpWzBdO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgZG9tYWluID0gdXJsO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGRvbWFpbjtcclxufVxyXG5leHBvcnRzLnJldHVybkRvbWFpbkZyb21VUkwgPSByZXR1cm5Eb21haW5Gcm9tVVJMO1xyXG4vKipTdG9yZXMgdGhlIHRlbXB1cyBvYmplY3QgaW4gdGhlIHN0b3JhZ2UgKi9cclxuZnVuY3Rpb24gc3RvcmVUZW1wdXNPYmplY3Qob2JqKSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGxvY2FsT2JqO1xyXG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsT2JqID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxPYmpbZXhwb3J0cy50ZW1wdXNPYmplY3RJRF0gPSBvYmo7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgc2V0U3RvcmFnZShsb2NhbE9iaildO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcbmV4cG9ydHMuc3RvcmVUZW1wdXNPYmplY3QgPSBzdG9yZVRlbXB1c09iamVjdDtcclxuLyoqU3RvcmVzIHRoZSB0ZW1wdXMgcmVmcmVzaGVyIGluIHRoZSBzdG9yYWdlICovXHJcbmZ1bmN0aW9uIHN0b3JlVGVtcHVzUmVmcmVzaGVyKG9iaikge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBsb2NhbE9iajtcclxuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgICAgICBsb2NhbE9iaiA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsT2JqW2V4cG9ydHMudGVtcHVzUmVmcmVzaGVySURdID0gb2JqO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHNldFN0b3JhZ2UobG9jYWxPYmopXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5leHBvcnRzLnN0b3JlVGVtcHVzUmVmcmVzaGVyID0gc3RvcmVUZW1wdXNSZWZyZXNoZXI7XHJcbi8qKlVwZGF0ZXMgYWxsIHRoZSBvcGVuIHRhYnMgKi9cclxuZnVuY3Rpb24gdXBkYXRlT3BlblRhYnMoKSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHRhYnMsIHRlbXB1c09iamVjdCwgdGVtcHVzUmVmcmVzaGVyLCB0ZW1wdXNBcnJheURvbWFpbnMsIGosIG9iajtcclxuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgcXVlcnlCcm93c2VyVGFicyh7fSldO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgIHRhYnMgPSBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgZmV0Y2hUZW1wdXNPYmplY3QoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcHVzT2JqZWN0ID0gX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGZldGNoVGVtcHVzUmVmcmVzaGVyKCldO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXB1c1JlZnJlc2hlciA9IF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wdXNBcnJheURvbWFpbnMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgdGVtcHVzT2JqZWN0LnRlbXB1c0FycmF5Lmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iaiA9IHRlbXB1c09iamVjdC50ZW1wdXNBcnJheVtqXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcHVzQXJyYXlEb21haW5zLnB1c2gob2JqLmRvbWFpbik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIGFueSBvZiB0aGUgdGFic0RvbWFpbnMgZG8gbm90IGhhdmUgYW4gZW50cnkgaW4gdGVtcHVzQXJyYXlEb21haW5zLCB0aGVuIGFkZCBpdCB0byB0aGUgbGlzdFxyXG4gICAgICAgICAgICAgICAgICAgIHRhYnMuZm9yRWFjaChmdW5jdGlvbiAodGFiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YWIudXJsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZG9tYWluID0gcmV0dXJuRG9tYWluRnJvbVVSTCh0YWIudXJsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IHRlbXB1c0FycmF5RG9tYWlucy5pbmRleE9mKGRvbWFpbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wdXNPYmplY3QudGVtcHVzQXJyYXkucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZTogdGFiLmFjdGl2ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWluOiBkb21haW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2YXRlZEF0OiBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFwc2VkOiAwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHRhYiB0byBhY3RpdmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFiLmFjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWwgPSB0ZW1wdXNPYmplY3QudGVtcHVzQXJyYXlbaW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5hY3RpdmUgPSB0YWIuYWN0aXZlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wdXNPYmplY3QudGVtcHVzQXJyYXkuc3BsaWNlKGluZGV4LCAxLCBlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgc3RvcmVUZW1wdXNPYmplY3QodGVtcHVzT2JqZWN0KV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6XHJcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuZXhwb3J0cy51cGRhdGVPcGVuVGFicyA9IHVwZGF0ZU9wZW5UYWJzO1xyXG4vLyBBbGFybXNcclxuLyoqQ3JlYXRlcyB0aGUgYWxhcm0gKi9cclxuZnVuY3Rpb24gY3JlYXRlQWxhcm0oKSB7XHJcbiAgICBjcmVhdGVCcm93c2VyQWxhcm0oZXhwb3J0cy5yZWZyZXNoQWxhcm0sIHsgZGVsYXlJbk1pbnV0ZXM6IGV4cG9ydHMucmVmcmVzaERlbGF5SW5NaW5zIH0sIHJlZnJlc2hUaW1lc3RhbXApO1xyXG59XHJcbi8qKlJlc2V0cyB0aGUgYWxhcm1zICovXHJcbmZ1bmN0aW9uIHJlc2V0QWxhcm0oKSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGNsZWFyQnJvd3NlckFsYXJtKGV4cG9ydHMucmVmcmVzaEFsYXJtKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZUFsYXJtKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG4vKipFdmVudCBoYW5kbGVyIHRoYXQgaGFuZGxlcyB0aGUgYWxhcm0gZmlyZSAqL1xyXG5mdW5jdGlvbiByZWZyZXNoVGltZXN0YW1wKCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciB0ZW1wdXNSZWZyZXNoZXIsIHRlbXB1c09iamVjdDtcclxuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgZmV0Y2hUZW1wdXNSZWZyZXNoZXIoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcHVzUmVmcmVzaGVyID0gX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXB1c1JlZnJlc2hlci5yZWZyZXNoZWRfYXQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBzdG9yZVRlbXB1c1JlZnJlc2hlcih0ZW1wdXNSZWZyZXNoZXIpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgZmV0Y2hUZW1wdXNPYmplY3QoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcHVzT2JqZWN0ID0gX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXB1c09iamVjdC50ZW1wdXNBcnJheS5mb3JFYWNoKGZ1bmN0aW9uICh0ZW1wdXNTdHJ1Y3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXB1c1N0cnVjdC5hY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXB1c1N0cnVjdC5sYXBzZWQgKz0gdGVtcHVzUmVmcmVzaGVyLnJlZnJlc2hlZF9hdCAtIHRlbXB1c1N0cnVjdC5hY3RpdmF0ZWRBdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXB1c1N0cnVjdC5hY3RpdmF0ZWRBdCA9IHRlbXB1c1JlZnJlc2hlci5yZWZyZXNoZWRfYXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBzdG9yZVRlbXB1c09iamVjdCh0ZW1wdXNPYmplY3QpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNDpcclxuICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgcmVzZXRBbGFybSgpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNTpcclxuICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG4vKipIYW5kbGUgdGhlIGZpcnN0IHJ1biAqL1xyXG5mdW5jdGlvbiBvbkZpcnN0TG9hZCgpIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgY2xvc2VQcmV2aW91c2x5VW5jbG9zZWRUYWJzKCldO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB1cGRhdGVPcGVuVGFicygpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgcmVzZXRBbGFybSgpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5leHBvcnRzLm9uRmlyc3RMb2FkID0gb25GaXJzdExvYWQ7XHJcbi8qKkRlbGV0ZXMgdGhlIHN0b3JhZ2UgKi9cclxuZnVuY3Rpb24gX19kZWxldGVTdG9yYWdlKCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCBjbGVhclN0b3JhZ2UoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuZXhwb3J0cy5fX2RlbGV0ZVN0b3JhZ2UgPSBfX2RlbGV0ZVN0b3JhZ2U7XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xyXG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcclxuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XHJcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xyXG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xyXG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSB5W29wWzBdICYgMiA/IFwicmV0dXJuXCIgOiBvcFswXSA/IFwidGhyb3dcIiA6IFwibmV4dFwiXSkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XHJcbiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbMCwgdC52YWx1ZV07XHJcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxyXG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xyXG4gICAgfVxyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbnZhciBjb21tb25zID0gcmVxdWlyZShcIi4vY29tbW9uc1wiKTtcclxudmFyIHRhYmxlQm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGJvZHlcIik7XHJcbnZhciByZXNldEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzZXQtYnV0dG9uXCIpO1xyXG52YXIgc29ydEJ5RG9tYWluQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzb3J0LWJ5LWRvbWFpblwiKTtcclxudmFyIHNvcnRCeUR1cmF0aW9uQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzb3J0LWJ5LWR1cmF0aW9uXCIpO1xyXG52YXIgc29ydEJ5U3RhdHVzQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzb3J0LWJ5LWFjdGl2ZVwiKTtcclxudmFyIG1pbGxpc2Vjb25kID0gMTtcclxudmFyIHNlY29uZCA9IDEwMDAgKiBtaWxsaXNlY29uZDtcclxudmFyIG1pbnV0ZSA9IDYwICogc2Vjb25kO1xyXG52YXIgaG91ciA9IDYwICogbWludXRlO1xyXG5pZiAocmVzZXRCdXR0b24pIHtcclxuICAgIHJlc2V0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2dCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGNvbW1vbnMuX19kZWxldGVTdG9yYWdlKCldO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBjb21tb25zLmNsb3NlUHJldmlvdXNseVVuY2xvc2VkVGFicygpXTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgY29tbW9ucy51cGRhdGVPcGVuVGFicygpXTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhYmxlQm9keSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVCb2R5LmlubmVySFRNTCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFpbigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuLyoqVG9nZ2xlcyB0aGUgc29ydCBvcmRlciAqL1xyXG5mdW5jdGlvbiB0b2dnbGVTb3J0T3JkZXIoKSB7XHJcbiAgICB2YXIgc29ydE9yZGVyID0gdGFibGVCb2R5LmdldEF0dHJpYnV0ZShcImRhdGEtc29ydC1vcmRlclwiKTtcclxuICAgIGlmIChzb3J0T3JkZXIgPT0gXCJhc2NcIikge1xyXG4gICAgICAgIHNvcnRPcmRlciA9IFwiZGVzY1wiO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgc29ydE9yZGVyID0gXCJhc2NcIjtcclxuICAgIH1cclxuICAgIHRhYmxlQm9keS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXNvcnQtb3JkZXJcIiwgc29ydE9yZGVyKTtcclxuICAgIHJldHVybiBzb3J0T3JkZXI7XHJcbn1cclxuc29ydEJ5RG9tYWluQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2dCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBzb3J0T3JkZXI7XHJcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdGFibGVCb2R5LnNldEF0dHJpYnV0ZShcImRhdGEtc29ydC1ieVwiLCBcImRvbWFpblwiKTtcclxuICAgICAgICAgICAgc29ydE9yZGVyID0gdG9nZ2xlU29ydE9yZGVyKCk7XHJcbiAgICAgICAgICAgIGF0dGFjaEFycm93KHRoaXMsIHNvcnRPcmRlciwgXCJEb21haW5cIik7XHJcbiAgICAgICAgICAgIG1haW4oKTtcclxuICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5zb3J0QnlEdXJhdGlvbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChldnQpIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgc29ydE9yZGVyO1xyXG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHRhYmxlQm9keS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXNvcnQtYnlcIiwgXCJkdXJhdGlvblwiKTtcclxuICAgICAgICAgICAgc29ydE9yZGVyID0gdG9nZ2xlU29ydE9yZGVyKCk7XHJcbiAgICAgICAgICAgIGF0dGFjaEFycm93KHRoaXMsIHNvcnRPcmRlciwgXCJEdXJhdGlvblwiKTtcclxuICAgICAgICAgICAgbWFpbigpO1xyXG4gICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7XHJcbnNvcnRCeVN0YXR1c0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChldnQpIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgc29ydE9yZGVyO1xyXG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHRhYmxlQm9keS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXNvcnQtYnlcIiwgXCJhY3RpdmVcIik7XHJcbiAgICAgICAgICAgIHNvcnRPcmRlciA9IHRvZ2dsZVNvcnRPcmRlcigpO1xyXG4gICAgICAgICAgICAvKipDb3B5IGZyb20gaGVyZSAqL1xyXG4gICAgICAgICAgICBhdHRhY2hBcnJvdyh0aGlzLCBzb3J0T3JkZXIsIFwiU3RhdHVzXCIpO1xyXG4gICAgICAgICAgICAvKipVbnRpbCBoZXJlICovXHJcbiAgICAgICAgICAgIG1haW4oKTtcclxuICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5mdW5jdGlvbiBhdHRhY2hBcnJvdyh0aCwgc29ydE9yZGVyLCB0eXBlKSB7XHJcbiAgICB2YXIgaSA9IHRoLnBhcmVudEVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJpXCIpWzBdO1xyXG4gICAgaWYgKHNvcnRPcmRlciA9PSBcImFzY1wiKSB7XHJcbiAgICAgICAgaS5jbGFzc05hbWUgPSBcImZhIGZhLWFycm93LXVwXCI7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBpLmNsYXNzTmFtZSA9IFwiZmEgZmEtYXJyb3ctZG93blwiO1xyXG4gICAgfVxyXG4gICAgLy8gUmVtb3ZlIGl0IGZyb20gdGhlIGN1cnJlbnQgbG9jYXRpb25cclxuICAgIHZhciBwYXJlbnRFbCA9IGkucGFyZW50RWxlbWVudDtcclxuICAgIHBhcmVudEVsLnJlbW92ZUNoaWxkKGkpO1xyXG4gICAgLy8gQXBwZW5kIGl0XHJcbiAgICB0aC5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgdGguaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYWZ0ZXJiZWdpblwiLCBpLm91dGVySFRNTCArIHR5cGUpO1xyXG59XHJcbi8qKk1haW4gcnVubmVyICovXHJcbmZ1bmN0aW9uIG1haW4oKSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHRlbXB1c09iamVjdCwgc29ydE9yZGVyLCBzb3J0Qnk7XHJcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGNvbW1vbnMuZmV0Y2hUZW1wdXNPYmplY3QoKV07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcHVzT2JqZWN0ID0gX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNvcnRPcmRlciA9IHRhYmxlQm9keS5nZXRBdHRyaWJ1dGUoXCJkYXRhLXNvcnQtb3JkZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgc29ydEJ5ID0gdGFibGVCb2R5LmdldEF0dHJpYnV0ZShcImRhdGEtc29ydC1ieVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBTb3J0IGJ5IEFjdGl2ZVxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXB1c09iamVjdC50ZW1wdXNBcnJheS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzb3J0QnkgPT0gXCJkdXJhdGlvblwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc29ydEJ5RHVyYXRpb24oYSwgYiwgc29ydE9yZGVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzb3J0QnkgPT0gXCJkb21haW5cIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNvcnRCeURvbWFpbihhLCBiLCBzb3J0T3JkZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzb3J0QnlBY3RpdmUoYSwgYiwgc29ydE9yZGVyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZW5kZXJUYWJsZSh0ZW1wdXNPYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuLyoqU29ydHMgdGhlIHRlbXB1c0FycmF5IGJ5IERvbWFpbiAqL1xyXG5mdW5jdGlvbiBzb3J0QnlEb21haW4oYSwgYiwgb3JkZXIpIHtcclxuICAgIGlmICghb3JkZXIpIHtcclxuICAgICAgICBvcmRlciA9ICdhc2MnO1xyXG4gICAgfVxyXG4gICAgaWYgKGEuZG9tYWluID4gYi5kb21haW4pIHtcclxuICAgICAgICBpZiAob3JkZXIgPT0gXCJhc2NcIikge1xyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAob3JkZXIgPT0gXCJhc2NcIikge1xyXG4gICAgICAgIHJldHVybiAxO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIC0xO1xyXG59XHJcbi8qKlNvcnRzIHRoZSB0ZW1wdXNBcnJheSBieSBEdXJhdGlvbiAqL1xyXG5mdW5jdGlvbiBzb3J0QnlEdXJhdGlvbihhLCBiLCBvcmRlcikge1xyXG4gICAgaWYgKCFvcmRlcikge1xyXG4gICAgICAgIG9yZGVyID0gJ2FzYyc7XHJcbiAgICB9XHJcbiAgICBpZiAoYS5sYXBzZWQgPiBiLmxhcHNlZCkge1xyXG4gICAgICAgIGlmIChvcmRlciA9PSBcImFzY1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChvcmRlciA9PSBcImFzY1wiKSB7XHJcbiAgICAgICAgcmV0dXJuIDE7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gLTE7XHJcbn1cclxuLyoqU29ydHMgdGhlIHRlbXB1c0FycmF5IGJ5IEFDVElWRSAqL1xyXG5mdW5jdGlvbiBzb3J0QnlBY3RpdmUoYSwgYiwgb3JkZXIpIHtcclxuICAgIGlmICghb3JkZXIpIHtcclxuICAgICAgICBvcmRlciA9ICdhc2MnO1xyXG4gICAgfVxyXG4gICAgaWYgKGEuYWN0aXZlID4gYi5hY3RpdmUpIHtcclxuICAgICAgICBpZiAob3JkZXIgPT0gXCJhc2NcIikge1xyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAob3JkZXIgPT0gXCJhc2NcIikge1xyXG4gICAgICAgIHJldHVybiAxO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIC0xO1xyXG59XHJcbi8qKlJlbmRlcnMgdGhlIHRhYmxlIGRpc3BsYXlpbmcgdGhlIGRvbWFpbiBhbmQgZHVyYXRpb24gKi9cclxuZnVuY3Rpb24gcmVuZGVyVGFibGUodGVtcHVzT2JqZWN0KSB7XHJcbiAgICB2YXIgdGFibGVCb2R5U3RyaW5nID0gJyc7XHJcbiAgICB0ZW1wdXNPYmplY3QudGVtcHVzQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAodGVtcHVzKSB7XHJcbiAgICAgICAgdGFibGVCb2R5U3RyaW5nICs9IFwiXFxuICAgICAgICA8dHIgY2xhc3M9J1wiICsgcmV0dXJuUm93Q2xhc3ModGVtcHVzLmFjdGl2ZSkgKyBcIic+XFxuICAgICAgICAgICAgPHRkPlwiICsgdGVtcHVzLmRvbWFpbiArIFwiPC90ZD5cXG4gICAgICAgICAgICA8dGQ+XCIgKyByZXR1cm5UaW1lTGFwc2VkKHRlbXB1cy5sYXBzZWQpICsgXCI8L3RkPlxcbiAgICAgICAgICAgIDx0ZD5cIiArIHJldHVybkFjdGl2ZVN0YXR1cyh0ZW1wdXMuYWN0aXZlKSArIFwiPC90ZD5cXG4gICAgICAgIDwvdHI+XFxuICAgICAgICBcIjtcclxuICAgIH0pO1xyXG4gICAgLy8gPHRkPiR7TWF0aC5yb3VuZCh0ZW1wdXMubGFwc2VkIC8gMTAwMCl9czwvdGQ+XHJcbiAgICBpZiAodGFibGVCb2R5KSB7XHJcbiAgICAgICAgdGFibGVCb2R5LmlubmVySFRNTCA9IHRhYmxlQm9keVN0cmluZztcclxuICAgIH1cclxufVxyXG4vKipSZXR1cm5zIHRoZSBhY3RpdmUgY2xhc3MgY29sb3IgZGVwZW5kaW5nIG9uIHRoZSBzdGF0dXMgKi9cclxuZnVuY3Rpb24gcmV0dXJuUm93Q2xhc3MoYWN0aXZlKSB7XHJcbiAgICBpZiAoYWN0aXZlKSB7XHJcbiAgICAgICAgcmV0dXJuICdncmVlbic7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gJyc7XHJcbn1cclxuLyoqUmV0dXJucyB0aGUgdGltZSBsYXBzZWQgaW4gdGhlIGZvbGxvd2luZyBmb3JtYXQ6XHJcbiAqIElmIGxlc3MgdGhhbiAxIG1pbiwgZm9ybWF0IHdpbGwgYmUgWHNcclxuICogSWYgZ3JlYXRlciB0aGFuIDEgbWluIGFuZCBsZXNzIHRoYW4gMSBob3VyLCBmb3JtYXQgd2lsbCBiZSBYWDpZWW1cclxuICogT3RoZXJ3aXNlLCB3aWxsIGJlIFhYOllZOlpaaCAqL1xyXG5mdW5jdGlvbiByZXR1cm5UaW1lTGFwc2VkKGxhcHNlZCkge1xyXG4gICAgaWYgKGxhcHNlZCA8IG1pbnV0ZSkge1xyXG4gICAgICAgIHJldHVybiBNYXRoLnJvdW5kKGxhcHNlZCAvIHNlY29uZCkudG9TdHJpbmcoKSArIFwic1wiO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAobGFwc2VkIDwgaG91cikge1xyXG4gICAgICAgIHJldHVybiBwYWQoTWF0aC5yb3VuZChsYXBzZWQgLyBtaW51dGUpKS50b1N0cmluZygpICsgXCI6XCIgKyBwYWQoTWF0aC5yb3VuZCgobGFwc2VkICUgbWludXRlKSAvIHNlY29uZCkpLnRvU3RyaW5nKCkgKyBcIm1cIjtcclxuICAgIH1cclxuICAgIHZhciBoID0gTWF0aC5yb3VuZChsYXBzZWQgLyBob3VyKTtcclxuICAgIHZhciBtID0gTWF0aC5yb3VuZChsYXBzZWQgJSBoKTtcclxuICAgIHZhciBzID0gTWF0aC5yb3VuZCgobSAlIG1pbnV0ZSkgLyBzZWNvbmQpO1xyXG4gICAgbSA9IE1hdGgucm91bmQobSAvIG1pbnV0ZSk7XHJcbiAgICByZXR1cm4gcGFkKGgpLnRvU3RyaW5nKCkgKyBcIjpcIiArIHBhZChtKS50b1N0cmluZygpICsgXCI6XCIgKyBwYWQocykudG9TdHJpbmcoKSArIFwiaFwiO1xyXG59XHJcbi8qKlJldHVybnMgdGhlIEFDVElWRSBzdGF0ZSAqL1xyXG5mdW5jdGlvbiByZXR1cm5BY3RpdmVTdGF0dXMoYWN0aXZlKSB7XHJcbiAgICBpZiAoYWN0aXZlKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiQWN0aXZlXCI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gXCJJbmFjdGl2ZVwiO1xyXG59XHJcbi8qKlJldHVybnMgYSBwYWRkZWQgbnVtYmVyICovXHJcbmZ1bmN0aW9uIHBhZChuKSB7XHJcbiAgICByZXR1cm4gbiA8IDEwID8gJzAnICsgbiA6IG47XHJcbn1cclxubWFpbigpO1xyXG5zZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICBtYWluKCk7XHJcbn0sIDIwMDApO1xyXG4iXX0="}